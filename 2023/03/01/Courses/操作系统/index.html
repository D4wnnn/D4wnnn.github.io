

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" href="/img/avatar.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="D4wn">
  <meta name="keywords" content="后端,博客,网络安全,爬虫,D4wn,d4wnnn,脚本,Selenium,计算机网络,操作系统">
  
    <meta name="description" content="操作系统 一、操作系统引论 1.1 操作系统的目标和作用 联机命令接口：交互式命令接口 脱机命令接口：批处理命令接口 裸机：没有任何软件支持的计算机 什么是操作系统:  操作系统是一组控制和管理计算机软硬件资源，合理地对各类作业进行调度，以及方便用户使用的程序集合  OS的目标：  方便性：使计算机更易于使用 有效性：以更有效的方式使用计算机系统资源  提高系统资源利">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统">
<meta property="og:url" content="https://d4wnnn.github.io/2023/03/01/Courses/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="D4wn">
<meta property="og:description" content="操作系统 一、操作系统引论 1.1 操作系统的目标和作用 联机命令接口：交互式命令接口 脱机命令接口：批处理命令接口 裸机：没有任何软件支持的计算机 什么是操作系统:  操作系统是一组控制和管理计算机软硬件资源，合理地对各类作业进行调度，以及方便用户使用的程序集合  OS的目标：  方便性：使计算机更易于使用 有效性：以更有效的方式使用计算机系统资源  提高系统资源利">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://d4wnnn.github.io/img/os.png">
<meta property="article:published_time" content="2023-02-28T16:34:05.000Z">
<meta property="article:modified_time" content="2024-06-10T15:52:42.752Z">
<meta property="article:author" content="D4wn">
<meta property="article:tag" content="操作系统">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://d4wnnn.github.io/img/os.png">
  
  
  
  <title>操作系统 - D4wn</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"d4wnnn.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":"104d1c240fe4777ab966bd68252f7714","google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?104d1c240fe4777ab966bd68252f7714";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.2.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>D4wn</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/total.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="操作系统"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        D4wn
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-01 00:34" pubdate>
          2023年3月1日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          160 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">操作系统</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="操作系统">操作系统</h1>
<h2 id="一操作系统引论">一、操作系统引论</h2>
<h3 id="操作系统的目标和作用">1.1 操作系统的目标和作用</h3>
<p>联机命令接口：交互式命令接口</p>
<p>脱机命令接口：批处理命令接口</p>
<p>裸机：没有任何软件支持的计算机</p>
<p>什么是操作系统:</p>
<ul>
<li>操作系统是一组控制和管理计算机软硬件资源，合理地对各类作业进行调度，以及方便用户使用的程序集合</li>
</ul>
<p>OS的目标：</p>
<ul>
<li>方便性：使计算机更易于使用</li>
<li>有效性：以更有效的方式使用计算机系统资源
<ul>
<li>提高系统资源利用率</li>
<li>提高系统吞吐量</li>
</ul></li>
<li>可拓展性：允许有效地开发，测试和引进新的系统功能。</li>
<li>开放性：实现应用程序的可移植性和互操作性**,要求具有统一的开放的环境</li>
</ul>
<p>OS的作用：</p>
<ul>
<li>作为用户与计算机硬件系统之间的接口</li>
<li>作为计算机系统资源的管理者(软件和硬件资源)</li>
<li>用作扩充机器</li>
</ul>
<h3 id="操作系统的发展过程">1.2 操作系统的发展过程</h3>
<ul>
<li><p>手工操作阶段</p>
<ul>
<li>缺点：
<ul>
<li>用户独占全机</li>
<li>cpu等待人工操作</li>
<li>人机速度矛盾导致资源利用率低</li>
</ul></li>
</ul></li>
<li><p>批处理阶段</p>
<ul>
<li><p>单道批处理系统</p>
<p>特征：自动性、顺序性、单道性</p>
<p>缺点：资源利用率不高、平均周转时间长、没有交互能力</p></li>
<li><p>多道批处理系统(操作系统开始出现)</p>
<p>特征：调度性、无序性、多道性</p>
<p>缺点：平均周转时间长、没有交互能力</p></li>
</ul></li>
<li><p>分时操作系统</p>
<p>特征：多路性、独立性、及时性、交互性</p></li>
<li><p>实时操作系统</p>
<p>特征：多路性、独立性、交互性、可靠性、及时性</p></li>
</ul>
<h3 id="操作系统的基本特性">1.3 操作系统的基本特性</h3>
<p>现代OS的四个基本特征</p>
<ul>
<li><p>并发性</p>
<ul>
<li>并行：指两个或多个事件在同一时刻发生</li>
<li>并发：指两个或多个事件在同一时间间隔内发生</li>
</ul></li>
<li><p>共享性</p>
<p>指的是系统中的资源可供内存中多个并发执行的进程共同使用</p>
<ul>
<li>互斥共享：一段时间内只允许一个进程使用，这种资源称为临界资源</li>
<li>同时访问方式：一段时间内，多个进程可以同时使用这个资源，从微观上看，是多个进程交替互斥地使用这个资源</li>
</ul></li>
<li><p>虚拟性</p>
<p>是指的通过某种技术把一个物理实体变为若干个逻辑上的对应物，用于实现虚拟的技术成为虚拟技术</p>
<ul>
<li>时分复用技术
<ul>
<li>虚拟处理机，分时实现</li>
<li>虚拟设备，SPOOLing</li>
</ul></li>
<li>时分复用技术
<ul>
<li>虚拟磁盘：逻辑分区</li>
<li>虚拟存储器：虚拟存储管理实现</li>
</ul></li>
</ul></li>
<li><p>异步性</p>
<p>异步性：多道程序环境下程序以异步的方式执行，每道程序在何时执行都是不确定的</p></li>
</ul>
<h3 id="操作系统的主要功能">1.4 操作系统的主要功能</h3>
<ul>
<li>处理机管理功能</li>
<li>存储器管理</li>
<li>设备管理</li>
<li>文件管理</li>
<li>操作系统与用户之间的接口</li>
</ul>
<h3 id="操作系统的体系结构">1.5 操作系统的体系结构</h3>
<ul>
<li>无结构操作系统</li>
<li>模块结构OS</li>
<li>分层式结构OS</li>
<li>微内核OS结构</li>
</ul>
<h2 id="二进程的描述与控制">二、进程的描述与控制</h2>
<h3 id="程序执行">2.1 程序执行</h3>
<p>可执行文件运行的过程</p>
<p>a.out--作业调度--&gt;装入内存--创建--&gt;进程----&gt;就绪队列--调度--&gt;进程调度</p>
<p>程序并发执行时的特征：</p>
<ul>
<li>间断性</li>
<li>不可再现性</li>
<li>失去封闭性</li>
</ul>
<p>程序顺序执行时的特征：</p>
<ul>
<li>顺序性</li>
<li>封闭性</li>
<li>可再现性</li>
</ul>
<h3 id="进程的描述">2.2 进程的描述</h3>
<h4 id="进程的定义和特征">2.2.1 进程的定义和特征</h4>
<p>进程：</p>
<ul>
<li>进程是程序的一次执行，进程是系统进行资源分配和调度的一个基本单位</li>
</ul>
<p>特征：</p>
<ul>
<li>结构性</li>
<li>动态性：是进程最基本的特征，也就是有生命周期。</li>
<li>并发性</li>
<li>独立性</li>
<li>异步性</li>
</ul>
<p>PCB的内容：</p>
<ul>
<li><p>进程标识符</p></li>
<li><p>内部标识符，方便系统使用</p></li>
<li><p>外部标识符，由创建者提供，通常是字母数字组成，由用户访问该进程时使用</p></li>
<li><p>处理机状态：主要是由处理机的各种寄存器中的内容组成，比如通用寄存器，程序计数器，程序状态字PSW，用户栈指针</p></li>
<li><p>进程的调度信息：比如进程的状态，进程的优先级，堵塞的原因</p></li>
<li><p>进程的控制信息：比如程序和数据的地址，进程同步和通信机制，资源清单，链接指针</p></li>
</ul>
<p>PCB的作用：</p>
<ul>
<li>是进程存在的唯一标志</li>
<li>能实现间断性运行方式</li>
<li>提供进程管理所需要的信息</li>
<li>提供进程调度所需要的信息</li>
<li>实现与其他进程的同步与通信</li>
</ul>
<p>进程的结构：</p>
<p>为使程序(含数据)能独立运行，应为之配置一进程控制块，即PCB</p>
<p>进程实体（进程在某个时间点的快照）：</p>
<ul>
<li>程序段</li>
<li>数据段</li>
<li>PCB：PCB是给操作系统用的，程序段和数据段是程序自己用的</li>
</ul>
<h4 id="进程的基本状态及切换">2.2.2 进程的基本状态及切换</h4>
<p>进程的三种基本状态</p>
<ul>
<li>就绪状态：万事俱备，只欠cpu</li>
<li>执行状态</li>
<li>阻塞状态</li>
</ul>
<figure>
<img src="/2023/03/01/Courses/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20230306201505467.png" srcset="/img/loading.gif" lazyload alt="image-20230306201505467">
<figcaption aria-hidden="true">image-20230306201505467</figcaption>
</figure>
<p>进程挂起状态的原因</p>
<ul>
<li>父进程请求</li>
<li>终端用户的请求</li>
<li>负荷调节的需要</li>
<li>操作系统的需要。希望挂起某进程，检车资源使用情况或进行记账</li>
</ul>
<p>被挂起进程的特征</p>
<ul>
<li>不能立即执行</li>
<li>可能是等待某事件发生。若是，则堵塞条件独立于挂起条件，即使堵塞事件发生，该进程也不能执行</li>
<li>使之挂起的进程为OS，自身，或其他进程</li>
<li>只有使之挂起的进程才能使之由挂起状态转换为其他状态</li>
</ul>
<h4 id="进程的组织">2.2.3 进程的组织</h4>
<p>实际就是PCB的组织</p>
<ul>
<li>线性方式：所有PCB在一张线性表中</li>
<li>链接方式：按照进程状态，将PCB分为多个队列
<ul>
<li>执行指针</li>
<li>就绪队列指针</li>
<li>阻塞队列指针</li>
</ul></li>
<li>索引方式：根据进程状态的不同，建立几张索引表
<ul>
<li>执行指针</li>
<li>就绪表指针</li>
<li>阻塞表指针</li>
</ul></li>
</ul>
<h3 id="进程控制">2.3 进程控制</h3>
<p>进程控制：就是实现进程状态的转换</p>
<p>原语：是一种特殊的程序，它的执行具有原子性，进程的控制用原语实现</p>
<p>处理机的执行态：</p>
<ul>
<li>系统态，又称管态，也称为内核态</li>
<li>用户态，也称目态</li>
</ul>
<p>OS内核包含两大功能：</p>
<ul>
<li>支撑功能</li>
<li>资源管理功能</li>
</ul>
<p>进程/原语创建过程：</p>
<ol type="1">
<li>申请空白PCB</li>
<li>为新进程分配资源</li>
<li>初始化空白的PCB
<ul>
<li>初始化标识信息</li>
<li>初始化处理机状态信息</li>
<li>初始化处理机控制信息</li>
</ul></li>
<li>将PCB插入就绪队列</li>
</ol>
<p>引起进程终止的事件：</p>
<ul>
<li><p>正常结束</p></li>
<li><p>异常结束</p></li>
<li><p>外界干预</p></li>
</ul>
<p>撤销原语的过程：</p>
<ul>
<li>从PCB集合中找到终止进程的PCB，读出进程状态</li>
<li>若进程正在进行，立即剥夺CPU，将CPU分配给其他进程</li>
<li>终止所有子进程</li>
<li>将该进程拥有的所有资源归还给父进程或操作系统</li>
<li>将被终止进程的PCB从所在队列移出</li>
</ul>
<p>引起进程堵塞的事件：</p>
<ul>
<li>请求系统服务,比如IO</li>
<li>启动某种操作，只有该操作完成后才能继续执行</li>
<li>新数据尚未到达</li>
<li>无新工作可做</li>
</ul>
<p>进程堵塞过程：</p>
<ul>
<li>把PCB中的状态改为堵塞，并且把PCB插入到堵塞队列</li>
<li>转调度程序重新调度</li>
</ul>
<p>进程唤醒过程：</p>
<ul>
<li>首先把被堵塞的进程从该事件的堵塞队列中移出，然后把PCB中的现行状态由堵塞改为就绪</li>
<li>将PCB插入到就绪队列中</li>
</ul>
<p>进程挂起的执行过程：</p>
<ul>
<li>首先检查进程状态，若是活动就绪，改为静止就绪；活动堵塞改为静止堵塞</li>
<li>为了方便用户或OS考察该进程的运行情况而把该进程的PCB复制到某个特定区域</li>
<li>若被挂起的程序正在执行，则转向调度程序重新调度</li>
</ul>
<p>进程的激活过程：</p>
<ul>
<li>先将进程从外存调入内存，检查该进程的现行状态</li>
<li>若是静止就绪，便将之改为活动就绪；若为静止阻塞，便将之改为活动阻塞</li>
</ul>
<p>引起进程切换的事件：</p>
<ul>
<li>当前进程时间片到</li>
<li>有更高优先级的进程</li>
<li>当前进程主动阻塞</li>
<li>当前进程终止</li>
</ul>
<p>进程切换的基本步骤：</p>
<ul>
<li>保存进程上下文环境，将运行环境放到PCB中，更新PCB的状态，比如将改为就绪</li>
<li>更新PCB，改变其状态</li>
<li>将PCB移到相应的队列</li>
<li>改变需投入运行的进程的PCB内容，改变其运行状态</li>
<li>恢复需投入运行的进程的上下文环境</li>
</ul>
<h3 id="进程同步">2.4 进程同步</h3>
<p>临界资源：一次仅允许一个进程访问的资源为临界资源</p>
<p>为了实现对临界资源的互斥访问(同步机制应该遵循的原则)，需要遵循以下原则：</p>
<ul>
<li>空闲让进</li>
<li>忙则等待</li>
<li>有限等待：也就是保证不会饥饿</li>
<li>让权等待：当进程不能进入临界区的时候，应该立即释放处理机</li>
</ul>
<p>什么是进程同步？</p>
<ul>
<li>就是要让并发进程按照要求有序地推进</li>
</ul>
<p>进程同步的主要任务：</p>
<ul>
<li>是使并发执行的诸进程之间能有效地共享资源和相互合作，从而使程序的执行具有可再现性。</li>
</ul>
<h4 id="软件实现方法">2.4.1 软件实现方法</h4>
<p>单标志法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> turn = <span class="hljs-number">0</span>;<br><span class="hljs-comment">// 进程1</span><br><span class="hljs-keyword">while</span> (turn!=<span class="hljs-number">0</span>){ <span class="hljs-comment">// 进入区</span><br>    critical section; <span class="hljs-comment">// 临界区</span><br>    turn = <span class="hljs-number">1</span>; <span class="hljs-comment">// 退出区</span><br>    remainder section; <span class="hljs-comment">// 剩余区</span><br>}<br><span class="hljs-comment">// 进程2</span><br><span class="hljs-keyword">while</span> (turn!=<span class="hljs-number">1</span>){<br>    critical section;<br>    turn = <span class="hljs-number">0</span>;<br>    remainder section;<br>}<br></code></pre></td></tr></table></figure>
<p>缺点：违背了空闲让进原则。也就是，假如进程1明明不需要访问临界资源，但是进程2也不一定可以访问。</p>
<p>双标志先检查法：</p>
<p>先看一下对方是否有意愿，然后再进入临界区。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">bool</span> flag[<span class="hljs-number">2</span>];<br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 进程1</span><br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">1</span>]);<br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;<br>critical section;<br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>remainder section;<br><span class="hljs-comment">// 进程2</span><br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">0</span>]);<br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;<br>critical section;<br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br>remainder section;<br></code></pre></td></tr></table></figure>
<p>违反了忙则等待原则。</p>
<p>双标志后检查法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">bool</span> flag[<span class="hljs-number">2</span>];<br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 进程1</span><br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">1</span>]);<br>critical section;<br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>remainder section;<br><span class="hljs-comment">// 进程2</span><br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">0</span>]);<br>critical section;<br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br>remainder section;<br></code></pre></td></tr></table></figure>
<p>虽然解决了忙则等待原则，但是违背了空闲让进和有限等待原则。</p>
<p>Peterson皮特森算法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">bool</span> flag[<span class="hljs-number">2</span>];<br><span class="hljs-type">int</span> turn = <span class="hljs-number">0</span>; <span class="hljs-comment">// 表示哪个进程优先进入临界区</span><br><span class="hljs-comment">// 进程1</span><br>flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 表达自己的意愿</span><br>turn = <span class="hljs-number">1</span>; <span class="hljs-comment">// 愿意让对方先使用</span><br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">1</span>] &amp;&amp; turn==<span class="hljs-number">1</span>){<br>    critical section;<br>    flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>    remainder section;<br>}<br><span class="hljs-comment">// 进程2</span><br>flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 表达自己的意愿</span><br>turn = <span class="hljs-number">0</span>; <span class="hljs-comment">// 愿意让对方先使用</span><br><span class="hljs-keyword">while</span> (flag[<span class="hljs-number">0</span>] &amp;&amp; turn==<span class="hljs-number">0</span>){<br>    critical section;<br>    flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br>    remainder section;<br>}<br></code></pre></td></tr></table></figure>
<p>缺点：未遵循让权等待原则；</p>
<h4 id="硬件实现方法">2.4.2 硬件实现方法</h4>
<p>中断屏蔽算法：</p>
<p>优点：简单，高效</p>
<p>缺点：不适用多处理机；只适合操作系统内核，不适用用户进程(因为开关中断只能运行在内核态，如果让用户随意使用会很危险)。</p>
<p>Test And Set指令：</p>
<p>优点：简单，适用于多处理机</p>
<p>缺点：不满足让权等待原则。</p>
<p>Swap指令(XCHG指令，Exchange指令)</p>
<p>优点：实现简单，适用于多处理机</p>
<p>缺点：不满足让权等待原则。</p>
<h4 id="信号量机制">2.4.3 信号量机制</h4>
<p>信号量可以理解为一种变量，表示系统中某种资源的数量</p>
<p>wait和signal常简称为P、V操作</p>
<p>整型信号量</p>
<p>表示系统中某种资源的数量，仍然未满足让权等待原则，会出现忙等，很少使用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> S = <span class="hljs-number">1</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">wait</span><span class="hljs-params">(<span class="hljs-type">int</span> S)</span>{<br>    <span class="hljs-keyword">while</span> (S &lt;= <span class="hljs-number">0</span>);<br>    S = S - <span class="hljs-number">1</span>;<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">signal</span> <span class="hljs-params">(<span class="hljs-type">int</span> S)</span>{<br>    S = S + <span class="hljs-number">1</span>;<br>}<br></code></pre></td></tr></table></figure>
<p>记录型信号量</p>
<p>什么是记录型信号量：就是用记录型数据结构表示的信号量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span><br>    <span class="hljs-type">int</span> value;<span class="hljs-comment">// 剩余资源数</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">process</span> *<span class="hljs-title">L</span>;</span><span class="hljs-comment">// 等待队列</span><br>} semaphore;<br><span class="hljs-type">void</span> <span class="hljs-title function_">wait</span><span class="hljs-params">(semaphore S)</span>{<br>    S.value--;<br>    <span class="hljs-keyword">if</span> (S.value&lt;<span class="hljs-number">0</span>){<br>    	block (S.L);<br>    }<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">signal</span><span class="hljs-params">(semaphore S)</span>{<br>    S.value++;<br>    <span class="hljs-keyword">if</span> (S.value&lt;=<span class="hljs-number">0</span>){<br>    	wakeup (S.L);<br>    }<br>}<br></code></pre></td></tr></table></figure>
<p>如何利用信号量机制实现进程同步？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">P1(){<br>    code <span class="hljs-number">1</span>;<br>    code <span class="hljs-number">2</span>;<br>    V(S);<br>    code <span class="hljs-number">3</span>;<br>}<br>P2(){<br>    P(S);<br>    code <span class="hljs-number">4</span>;<br>    code <span class="hljs-number">5</span>;<br>}<br><span class="hljs-comment">// 上面的代码能保证code 4之前先运行code 1 和 code 2;</span><br></code></pre></td></tr></table></figure>
<h4 id="经典进程的同步问题">2.4.4 经典进程的同步问题</h4>
<h5 id="生产者-消费者问题">生产者-消费者问题</h5>
<p>实现互斥的P操作，一定要在实现同步的P操作之后</p>
<p>两个V操作的操作顺序可以交换</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore mutex = <span class="hljs-number">1</span>;<br>semaphore empty = <span class="hljs-number">1</span>;<br>semaphore full = <span class="hljs-number">0</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">producer</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>        wait(empty);<br>        wait(mutex);<br>        <span class="hljs-comment">//produce</span><br>        signal(mutex);<br>        signal(full);<br>    }<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">consumer</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>        wait(full);<br>        wait(mutex);<br>        <span class="hljs-comment">//consume</span><br>        signal(mutex);<br>        signal(empty);<br>    }<br>}<br></code></pre></td></tr></table></figure>
<p>多生产者多消费者问题：也就是生产者或消费者各自的种类有很多，而不是数量</p>
<p>桌子上有一只盘子，每次只能向其中放入一个水果。爸爸专向盘子中放苹果，妈妈专向盘子中放橘子，儿子专等着吃盘子中的橘子，女儿专等着吃盘子中的苹果。只有盘子空时，爸爸或妈妈才可向盘子中放一个水果，仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出水果用PV操作实现上述过程.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore mutex = <span class="hljs-number">1</span>;<br>semaphore plate = <span class="hljs-number">1</span>; <span class="hljs-comment">//盘子中有多少空位</span><br>semaphore apple = <span class="hljs-number">0</span>;<br>semaphore orange = <span class="hljs-number">0</span>; <br><span class="hljs-type">void</span> <span class="hljs-title function_">dad</span><span class="hljs-params">()</span>{<br>    wait(plate);<br>    wait(mutex);<br>    produce an apple;<br>    signal(mutex);<br>    signal(apple);<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">mum</span><span class="hljs-params">()</span>{<br>    wait(plate);<br>    wait(mutex);<br>    produce an orange;<br>    signal(mutex);<br>    signal(orange);<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">son</span><span class="hljs-params">()</span>{<br>    wait(orange);<br>    wait(mutex);<br>    eat an orange;<br>    signal(mutex);<br>    signal(plate);<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">daughter</span><span class="hljs-params">()</span>{<br>    wait(apple);<br>    wait(mutex);<br>    eat an apple;<br>    signal(mutex);<br>    signal(plate);<br>}<br></code></pre></td></tr></table></figure>
<h5 id="吸烟者问题">吸烟者问题</h5>
<p>假设一个系统有三个抽烟者进程和一个供应者进程。每个抽烟者不停地卷烟并抽掉它，但是要卷起并抽掉一支烟，抽烟者需要有三种材料:
烟草、纸和胶水。三个抽烟者中，第一个拥有烟草、第二个拥有纸、第三个拥有胶水。供应者进程无限地提供三种材料，供应者每次将两种材料放桌子上，拥有剩下那种材料的抽烟者卷一根烟并抽掉它，并给供应者进程一个信号告诉完成了，供应者就会放另外两种材料再桌上，这个过程一直重复(让三个抽烟者轮流地抽烟)。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore offer1 = <span class="hljs-number">0</span>;<br>semaphore offer2 = <span class="hljs-number">0</span>;<br>semaphore offer3 = <span class="hljs-number">0</span>;<br>semaphore finish = <span class="hljs-number">0</span>; <span class="hljs-comment">// 抽烟是否完成</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">provider</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>        <span class="hljs-keyword">if</span>(i==<span class="hljs-number">0</span>){<br>            V(offer1);<br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i==<span class="hljs-number">1</span>){<br>            V(offer2);<br>        }<span class="hljs-keyword">else</span>{<br>            V(offer3);<br>        }<br>        P(finish);<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span>;<br>    }<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">smoker1</span><span class="hljs-params">()</span>{<br>    P(offer1);<br>    preduce;<br>    V(finish);<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">smoker2</span><span class="hljs-params">()</span>{<br>    P(offer2);<br>    preduce;<br>    V(finish);<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">smoker3</span><span class="hljs-params">()</span>{<br>    P(offer3);<br>    preduce;<br>    V(finish);<br>}<br></code></pre></td></tr></table></figure>
<h5 id="哲学家进餐问题">哲学家进餐问题</h5>
<p>一张圆桌上坐着5名哲学家，每两个哲学家之间的桌上摆一根筷子，桌子的中间是一碗米饭。哲学家们倾注毕生的精力用于思考和进餐，哲学家在思考时，并不影响他人。只有当哲学家饥饿时，才试图拿起左、右两根筷子(一根一根地拿起)。如果筷子已在他人手上，则需等待。饥饿的哲学家只有同时拿起两根筷子才可以开始进餐，当进餐完毕后，放下筷子继续思考。</p>
<p>思路一：最多允许有4个哲学家同时进餐</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore chopstick[<span class="hljs-number">5</span>]={<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>}<br>semaphore room = <span class="hljs-number">4</span>;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>    think;<br>    wait(room);<br>    wait(chopstick[i]); <br>    wait(chopstick[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);<br>    eat;<br>    signal(chopstick[i]); <br>    signal(chopstick[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);<br>    signal(room);<br>}<br></code></pre></td></tr></table></figure>
<p>思路二：奇数号哲学家先拿左边的筷子，再拿右边的，偶数号哲学家相反。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore chop[<span class="hljs-number">5</span>]={<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>}<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>    think;<br>    <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>{<br>        wait(chop[i]);<br>        wait(chop((i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>));<br>        eat;<br>        signal(chop[i]);<br>        signal(chop((i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>));<br>    }<span class="hljs-keyword">else</span>{<br>        wait(chop((i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>));<br>        wait(chop[i]);<br>        eat;<br>        signal(chop((i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>));<br>        signal(chop[i]);<br>    }<br>}<br></code></pre></td></tr></table></figure>
<h5 id="读者-写者问题">读者-写者问题</h5>
<p>要求：</p>
<ul>
<li>读进程可以共享同一对象</li>
<li>写进程无法共享同一对象</li>
<li>任一写者在完成写操作之前不允许其他读者或写者工作</li>
<li>写者在执行写操作前保证已有的读者和写者全部退出</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore wmutex = <span class="hljs-number">1</span>; <span class="hljs-comment">// 实现互斥读写</span><br>semaphore cntMutex = <span class="hljs-number">1</span>; <span class="hljs-comment">// 实现count变量的原子操作</span><br><span class="hljs-type">int</span> count = <span class="hljs-number">0</span>; <span class="hljs-comment">// 记录有几个进程在访问文件</span><br>semaphore wPriority = <span class="hljs-number">1</span>; <span class="hljs-comment">// 用于实现写优先</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span><br>    <span class="hljs-title function_">whilt</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span>{<br>    	wait(wPriority);<br>        wait(wmutex);<br>        write file;<br>        signal(wmutex);<br>    	signal(wPriority);<br>    }<br>}<br><span class="hljs-type">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span>{<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>){<br>        wait(wPriority);<br>        wait(cntMutex);<br>        <span class="hljs-keyword">if</span>(count==<span class="hljs-number">0</span>){<br>            wait(rmutex)<br>        }<br>        count++;<br>        signal(cntMutex);<br>        signal(wPriority);<br>        <span class="hljs-comment">//read file;</span><br>        wait(cntMutex);<br>        count--;<br>        <span class="hljs-keyword">if</span>(count==<span class="hljs-number">0</span>){<br>            signal(rmutex);<br>        }<br>        signal(cntMutex);<br>    }<br>}<br></code></pre></td></tr></table></figure>
<h4 id="管程">2.4.5 管程</h4>
<p>引入管程的目的：更方便的实现进程互斥和同步。</p>
<p>由编译器负责实现各进程互斥地进入管程中的过程。例如Java中的synchronized修饰符。</p>
<h3 id="进程通信">2.6 进程通信</h3>
<p>为了保证安全，一个进程不能直接访问另一个进程的地址空间</p>
<p>进程通信分为两类：</p>
<ul>
<li><p>低级通信：信号量机制</p>
<p>缺点：</p>
<ul>
<li>效率低</li>
<li>对用户不透明</li>
</ul></li>
<li><p>高级通信：直接利用操作系统提供的一组通信命令</p>
<p>特点：效率高，通信细节对用户透明</p></li>
</ul>
<h4 id="共享存储">2.6.1 共享存储</h4>
<p>两个进程对共享空间的访问必须是互斥的</p>
<ul>
<li>基于数据结构的共享：数据的形式是固定的，这种共享方式速度慢，限制多，是一种低级的通信方式</li>
<li>基于存储区的共享：在内存中画出一块共享区，数据的形式、存放位置都由进程控制，而不是操作系统，这种共享方式速度更快，更加高级</li>
</ul>
<h4 id="消息传递">2.6.2 消息传递</h4>
<ul>
<li>直接通信方式：消息直接挂到接收进程的消息缓冲队列上</li>
<li>间接通信方式：消息先发送到中间实体(信箱)</li>
</ul>
<h4 id="管道通信">2.6.3 管道通信</h4>
<p>就是用于连接读写进程的共享文件，其实就是在内存中开辟一个大小固定的缓冲区</p>
<p>管道只能采用半双工通信，某一个时间段只能实现单向的传输。</p>
<p>功能：大量的数据发收。</p>
<h3 id="线程">2.7 线程</h3>
<p>进程的概念体现了两个基本属性：</p>
<ul>
<li><p>资源所有权</p></li>
<li><p>调度执行</p></li>
</ul>
<p>线程不进行资源管理</p>
<p>线程的属性：</p>
<ul>
<li>线程是可以并发执行的</li>
<li>共享进程资源</li>
<li>进程中所有的线程共享同一个地址空间，挂起进程会挂起所有线程</li>
<li>线程是轻型实体，在切换时只需保存少量寄存器的内容，不涉及存储器的管理，因此系统开销小</li>
</ul>
<p>进程和线程的比较：</p>
<ol type="1">
<li>调度：二者都是调度的基本单位，但是进程与资源绑定，线程不绑定；A进程到B进程是需要进程切换的，A线程到B线程在进程内部无需切换</li>
<li>并发性：进程是进程间并发，线程既可以是同一个进程内的线程并发，也可是多个进程的线程并发</li>
<li>拥有资源：进程是拥有资源的基本单位，线程共享进程内的资源</li>
<li>系统开销：进程创建和撤销进程的开销大，线程小</li>
<li>独立性：进程独立性高，同一个进程的多个线程独立性很低，共享同一进程的堆栈</li>
<li>运行基础：进程可脱离线程独立运行，线程必须在进程内部运行</li>
</ol>
<p>TCB的内容：</p>
<ul>
<li>线程表示符(进程之内唯一)</li>
<li>一组寄存器：它包括PC和堆栈指针中的内容</li>
<li>线程运行状态</li>
<li>优先级</li>
<li>专有存储区</li>
<li>用户栈：保存局部边和返回地址</li>
<li>信号屏蔽</li>
</ul>
<p>线程的分类:</p>
<ul>
<li><p>内核支持线程KST</p>
<p>优点：</p>
<ul>
<li>内核中可以同时把同一个进程中的线程调度到多个处理器中并行执行</li>
</ul></li>
<li><p>如果进程中的一个线程被阻塞。内核可以调度同一个进程中的另一个线程，也可以运行其他进程的线程</p></li>
<li><p>内核例程本身也可以多线程</p></li>
<li><p>结构简单，高效</p></li>
</ul>
<p>缺点：</p>
<ul>
<li><p>系统开销大</p></li>
<li><p>用户级线程ULT</p></li>
</ul>
<p>无需内核的支持</p>
<p>优点：</p>
<ul>
<li>线程控制块设置在用户空间，内核完全不知道用户级线程的存在，这样可以节省模式切换系统开销</li>
<li>各进程可以独立选择线程调度算法</li>
<li>与操作系统无关，甚至可以在不支持线程机制的操作系统平台实现</li>
</ul>
<p>缺点：</p>
<ul>
<li><p>当线程执行系统调用引起进程阻塞时，进程中所有的线程都会被阻塞</p></li>
<li><p>不能有效利用多处理机</p></li>
<li><p>混合状态，也就是多线程模型</p>
<ul>
<li><p>一对一模型：一个用户级线程对应一个内核级线程</p>
<p>优点：</p>
<ul>
<li><p>一个线程堵塞后，其他线程可以继续执行，并发能力强。</p></li>
<li><p>多个线程可以在多核处理机上并行运行</p></li>
</ul>
<p>缺点：一个进程要占用多个内核级线程，系统开销大</p></li>
<li><p>多对一模型：多个用户级线程对应一个内核级线程，且一个进程只分配到一个内核级线程</p>
<p>优点：线程切换在用户级空间完成，不需要切换到核心态，系统管理开销小，效率高</p>
<p>缺点：一个用户级线程堵塞后整个进程都会被堵塞，并且不可以并行运行</p></li>
<li><p>多对多模型：n个用户级线程对应m个内核级线程，且n≥m</p></li>
</ul></li>
</ul>
<p>线程的实现：https://www.bilibili.com/video/BV1V84y1Y77s?t=415.6&amp;p=2</p>
<ul>
<li>内核支持线程的实现</li>
</ul>
<p>系统为每个进程创建任务数据区</p>
<ul>
<li>用户级线程的实现
<ul>
<li>运行时系统，也就是虚拟机</li>
</ul></li>
</ul>
<h2 id="三处理机调度与死锁">三、处理机调度与死锁</h2>
<h3 id="处理机调度的基本概念">3.1 处理机调度的基本概念</h3>
<p>高级调度(作业调度)：</p>
<ul>
<li>用于决定外存尚处于后备队列中的哪些作业调入内存，主要用户批处理系统，运行频率最低</li>
</ul>
<p>低级调度(进程调度)：</p>
<ul>
<li>用来决定就绪队列中的哪个进程应获得处理机，由分派程序实现，主要用户交互式系统。频率最高，是毫秒级</li>
</ul>
<p>中级调度(内存调度)：</p>
<ul>
<li>提高内存的利用率和系统吞吐量，也就是就绪状态和挂起状态的切换，主要用户具有对换功能的系统</li>
</ul>
<p>调度的目标：</p>
<ul>
<li>提高处理机的利用率</li>
<li>提高系统吞吐量</li>
<li>尽量减少进程的响应时间</li>
<li>防止进程长期得不到运行</li>
</ul>
<p>调度的原则：</p>
<ul>
<li>满足用户的需要和系统的需要</li>
</ul>
<p>调度算法的共同目标：</p>
<ul>
<li>资源利用率</li>
<li>公平性</li>
<li>平衡性</li>
<li>策略强制执行</li>
</ul>
<p>CPU利用率 = cpu的有效工作台时间/总时间</p>
<p>面向用户的准则：</p>
<ul>
<li>周转时间尽量短</li>
<li>响应时间快</li>
<li>截止时间的保证</li>
<li>优先权准则</li>
</ul>
<p>面向系统的准则：</p>
<ul>
<li>系统吞吐量高</li>
<li>处理机利用率好</li>
<li>各类资源的平衡利用</li>
</ul>
<p>批处理系统的目标：</p>
<ul>
<li>平均周转时间短</li>
<li>系统吞吐量高</li>
<li>处理机利用率高</li>
</ul>
<p>分时操作系统的目标：</p>
<ul>
<li>响应时间快</li>
<li>均衡性</li>
</ul>
<p>实时操作系统的目标：</p>
<ul>
<li>截止时间的保证</li>
<li>可预测性</li>
</ul>
<p>周转时间包括哪个四部分：</p>
<ul>
<li>作业在外存后备队列上等待调度的时间</li>
<li>进程在就绪队列上等待进程调度的时间</li>
<li>进程在CPU上执行的时间</li>
<li>进程等待I/O操作完成的时间</li>
</ul>
<h3 id="作业与作业调度">3.2 作业与作业调度</h3>
<p>作业运行的三个阶段和三种状态</p>
<ul>
<li>收容状态</li>
<li>运行状态</li>
<li>完成状态</li>
</ul>
<p>调度算法</p>
<ul>
<li><p>==先来先服务FCFS==</p>
<p>缺点：对短进程不公平，如果排在队列后面，等待时间远大于执行时间。</p></li>
<li><p>==短作业优先SJF==</p>
<p>缺点：</p>
<ul>
<li>对长作业不利</li>
<li>不能保证紧迫性作业会被及时处理</li>
<li>用户对执行时间估计的不准确，算法不一定能真正做到短作业优先调度</li>
</ul></li>
<li><p>优先级调度算法PSA</p></li>
<li><p>==高响应比优先调度==</p>
<p><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.158ex;" xmlns="http://www.w3.org/2000/svg" width="41.654ex" height="3.447ex" role="img" focusable="false" viewbox="0 -1011.8 18410.9 1523.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">优</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">先</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">权</text></g><g data-mml-node="mo" transform="translate(3277.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(4333.6,0)"><g data-mml-node="mrow" transform="translate(220,481.4) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">等</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">待</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">间</text></g><g data-mml-node="mo" transform="translate(4000,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(4778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">要</text></g><g data-mml-node="mi" transform="translate(5778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">求</text></g><g data-mml-node="mi" transform="translate(6778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">服</text></g><g data-mml-node="mi" transform="translate(7778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">务</text></g><g data-mml-node="mi" transform="translate(8778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(9778,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">间</text></g></g><g data-mml-node="mrow" transform="translate(1909.3,-370.3) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">要</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">求</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">服</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">务</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">间</text></g></g><rect width="7821.2" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(12672.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(13728.3,0)"><g data-mml-node="mrow" transform="translate(927.1,481.4) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">响</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">应</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">间</text></g></g><g data-mml-node="mrow" transform="translate(220,-370.3) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">要</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">求</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">服</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">务</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">间</text></g></g><rect width="4442.6" height="60" x="120" y="220"/></g></g></g></svg></mjx-container></span></p>
<p>优点：既照顾了短作业，又考虑了作业到达的先后次序，不会使长作业长期得不到服务</p>
<p>缺点：每次调度前，都会先做相应比的计算，会增加系统开销</p></li>
</ul>
<h3 id="进程调度">3.3 进程调度</h3>
<p>RR和多级反馈队列是抢占式的，PSA可能抢占，也可能不抢占</p>
<p>进程调度的任务</p>
<ul>
<li>保存现场</li>
<li>选取进程</li>
<li>把处理机分配给要执行的进程</li>
</ul>
<p>进程调度方式</p>
<ul>
<li><p>非抢占式</p></li>
<li><p>抢占方式</p>
<p>抢占的主要原则是什么？</p>
<ul>
<li>优先权</li>
<li>短进程优先</li>
<li>时间片原则</li>
</ul>
<p>使用抢占式的原因：</p>
<ul>
<li>批处理：防止长进程长期占用CPU，不公平</li>
<li>分时：人机交互</li>
<li>实时：紧迫任务的执行</li>
</ul></li>
</ul>
<p>进程调度算法</p>
<ul>
<li><p>轮转调度算法(抢占式)</p>
<p>对于短的、计算型进程比较有利</p></li>
<li><p>优先级调度算法</p></li>
<li><p>多队列调度算法</p></li>
<li><p>多级反馈队列调度算法</p></li>
</ul>
<h3 id="实时调度">3.4 实时调度</h3>
<p>实现实时调度的基本条件</p>
<ol type="1">
<li>提供必要的信息</li>
<li>系统处理能力强</li>
<li>采用抢占式调度机制</li>
<li>具有快速切换机制</li>
</ol>
<h3 id="死锁概述">3.5 死锁概述</h3>
<p>死锁：</p>
<ul>
<li>如果一组进程中的每一个进程都在等待仅由该组进程中的其他进程才能引发的事件，那么该组进程是死锁的。</li>
</ul>
<p>为什么死锁？</p>
<ul>
<li>竞争资源
<ul>
<li>可重用资源的竞争</li>
<li>可消耗资源的竞争</li>
</ul></li>
<li>进程推进顺序非法</li>
</ul>
<p>死锁的发生必须具备下列四个必要条件：</p>
<ul>
<li>互斥条件</li>
<li>请求和保持条件</li>
<li>不剥夺条件</li>
<li>循环等待条件</li>
</ul>
<p>处理死锁的方法</p>
<ul>
<li>预防死锁：通过设置某些限制条件，去破坏产生死锁的四个必要条件中的一个或几个条件</li>
<li>避免死锁：在资源的动态分配过程中，用某种方法去防止系统进入不安全状态，从而避免发生死锁</li>
<li>检测死锁：通过系统所设置的<code>检测机构</code>，及时地检测出死锁的发生，并精确地确定与死锁有关的进程和资源</li>
<li>解除死锁：检测到系统中已发生死锁时，须将进程从死锁状态中解脱出来。</li>
</ul>
<h3 id="预防死锁">3.6 预防死锁</h3>
<p>预防死锁：通过设置某些限制条件，破坏产生死锁的四个必要条件中的一个或几个。</p>
<ul>
<li><p>破坏“互斥”条件：很少，例如SPOOLing技术，也就类似加上一个任务队列，使每个进程在逻辑上以为资源是共享的。</p></li>
<li><p>破坏“请求和保持”条件：</p>
<p>所有进程在开始运行前，都必须一次性地申请整个运行过程所需的全部资源。</p>
<ul>
<li>优点：简单，易于实现且很安全</li>
<li>缺点：资源被严重浪费，使进程延迟运行</li>
</ul></li>
<li><p>摒弃“不剥夺”条件：</p>
<p>当一个已经保持了某些资源的进程，再提出新的资源请求而不能立即得到满足时，必须释放所有正在保持的资源。</p>
<p>缺点：</p>
<ul>
<li>实现起来比较复杂，且要付出很大的代价。</li>
<li>一个资源在使用一段时间后，他的被迫释放可能会造成前段工作的失效。</li>
<li>会使进程前后两次运行的信息不连续。</li>
<li>因反复地申请和释放资源，致使进程被无限推迟，延长进程周转时间，增加系统开销，降低吞吐量。</li>
</ul></li>
<li><p>摒弃“环路等待”条件：</p>
<p>采用顺序资源分配法。首先给系统的资源进行编号，规定每个进程必须按照编号递增的顺序请求资源，同类资源一次申请完。</p>
<p>存在严重问题：</p>
<ul>
<li>为系统中各类资源分配的序号必须相对稳定，限制了新设备类型的增加。</li>
<li>会经常发生作业使用的顺序与系统规定顺序不同的情况，造成资源浪费。</li>
<li>增加了程序设计难度。</li>
</ul></li>
</ul>
<h3 id="避免死锁">3.7 避免死锁</h3>
<p>避免死锁：在资源的动态分配过程中，用某种方法去阻止系统进入不安全状态，从而避免发生死锁。</p>
<p>银行家算法步骤:</p>
<ol type="1">
<li>检查此次申请是否超过了之前声明的最大需求数</li>
<li>检查此时系统剩余的可用资源是否还能满足这次请求</li>
<li>试探着分配，更改各数据结构</li>
<li>用安全性算法检查此次分配是否会导致系统进入不安全状态</li>
</ol>
<p>安全性算法步骤:</p>
<ul>
<li>检查当前的剩余可用资源是否能满足某个进程的最大需求，如果可以，就把该进程加入安全序列。并把该进程持有的资源全部回收。</li>
<li>不断重复上述过程，看最终是否能让所有进程都加入安全序列。</li>
</ul>
<h3 id="死锁的检测和解除">3.8 死锁的检测和解除</h3>
<p>检测死锁的算法:</p>
<ul>
<li>在资源分配图中，找出既不阻塞又不是孤点的进程Pi。消去它所有的请求边和分配边，使之称为孤立的结点。</li>
<li>进程Pi所释放的资源，可以唤醒某些因等待这些资源而阻塞的进程，原来的阻塞进程可能变为非阻塞进程。若能消去途中所有的边，则称该图是可完全简化的。</li>
</ul>
<p>当发现发生死锁的时候，如何解除死锁？</p>
<ul>
<li>剥夺资源：也就是挂起一些死锁进程，将其资源分配给其他死锁进程</li>
<li>撤销进程：强制撤销部分甚至全部死锁进程，并剥夺资源，实现简单，但是付出的代价可能很大</li>
<li>进程回退：让死锁进程回退到足以避免死锁的地步。这要求系统要记录进程的历史信息，设置还原点。</li>
</ul>
<p>最小代价原则：</p>
<ul>
<li>进程优先级最小的进程</li>
<li>已经花费处理机时间最小的进程</li>
<li>未执行部分最多的进程</li>
<li>已获资源量最少的进程</li>
<li>到目前为止，产生输出量最少的进程</li>
<li>批处理进程</li>
</ul>
<h2 id="四存储器管理">四、存储器管理</h2>
<h3 id="地址转换">4.1 地址转换</h3>
<p>将源程序变为在内存中执行的程序通常要经历三步骤</p>
<ol type="1">
<li>编译：将<code>源代码</code>转换成若干个<code>目标模块</code></li>
<li>链接：将<code>一组目标模块</code>和他们所需要的<code>目标库函数</code>链接在一起，形成一个完整的装入模块</li>
<li>装入：由装入程序将装入模块装入内存</li>
</ol>
<h4 id="装入">4.1.1 装入</h4>
<ol type="1">
<li>绝对装入方式：</li>
</ol>
<ul>
<li>编译程序产生<code>绝对地址</code>的目标代码。</li>
<li>缺点:
<ul>
<li>只适合单道程序环境</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>可重定位装入方式：</li>
</ol>
<ul>
<li><p>经编译得到的目的模块中相对地址，通常从0开始。地址变换是在装入内存时一次完成的，且以后不能移动</p></li>
<li><p>优点：</p>
<ul>
<li>不需要硬件支持，可以装入有限多道程序</li>
</ul></li>
<li><p>缺点：</p>
<ul>
<li>程序通常需要占用连续的空间，程序装入内存后不能移动，不易实现共享</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>动态运行时装入方式：</li>
</ol>
<ul>
<li><p>也就是动态重定位，<code>把地址转换推迟到程序执行时</code>进行，可以利用硬件地址变换机构</p></li>
<li><p>优点：</p>
<ol type="1">
<li><p>主存的使用更加灵活有效。一个用户的作业不一定要分配在一个连续的存储区，因而可以使用较小的分配单位；作业开始前也不一定要把它的地址空间全部装入内存，可以在作业执行期间根据请求动态地分配</p></li>
<li><p>几个作业共享一个程序段的单个副本比较容易</p></li>
<li><p>用户可以运行比主存存储空间大得多的程序</p></li>
</ol></li>
<li><p>缺点：</p>
<ol type="1">
<li><p>需要硬件支持</p></li>
<li><p>实现存储器管理的软件比较复杂</p></li>
</ol></li>
</ul>
<h4 id="链接">4.1.2 链接</h4>
<p>根据链接时间的不同，可把链接分为三种：</p>
<ol type="1">
<li>静态链接</li>
</ol>
<ul>
<li><p>在<code>程序执行之前</code>就把各目标模块以及他们所需的库函数链接成一个完成的可执行文件，以后不再拆开</p></li>
<li><p>需要解决若干问题：</p>
<ul>
<li><p>修改相对地址</p></li>
<li><p>改变外部调用符号为相对地址</p></li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>装入时动态链接</li>
</ol>
<ul>
<li><p>边装入边链接</p></li>
<li><p>优点:</p>
<ul>
<li>便于软件修改和更新</li>
<li>便于实现目标模块共享</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>运行时动态链接</li>
</ol>
<ul>
<li><p>在程序执行中需要该模块时，才对他进行链接</p></li>
<li><p>优点:</p>
<ul>
<li>凡是在执行过程中未用到的目标模块，都不会调入内存和链接到模块上，这样不仅可以加快程序的装入过程，也可节省大量的内存空间</li>
</ul></li>
</ul>
<h3 id="内存的分配与回收">4.2 内存的分配与回收</h3>
<h4 id="连续分配方式">4.2.1 连续分配方式</h4>
<p>:star: 连续分配的三种方式</p>
<p>概念：连续分配方式是为用户程序分配一个连续的内存空间</p>
<blockquote>
<ul>
<li><p>单一连续分配方式</p>
<ul>
<li>概念：
<ul>
<li>内存被分为两个部分：系统区和用户区</li>
<li>系统区通常位于内存的低地址部分</li>
<li>用户区存放用户进程相关的数据，内存中只能有一道用户程序，用户程序独占整个用户区空间</li>
</ul></li>
<li>优点：
<ul>
<li>实现简单，易于管理</li>
</ul></li>
<li>缺点：
<ul>
<li>对要求内存少的程序，造成内存浪费</li>
<li>程序全部装入，很少使用的程序部分也占有内存</li>
</ul></li>
</ul></li>
<li><p>固定分区分配</p>
<ul>
<li><p>概念：</p>
<ul>
<li>将整个用户空间分为若干个固定大小的分区，每个分区中只装入一道作业</li>
</ul></li>
<li><p>分类：</p>
<ul>
<li>分区大小相等：适用于一台计算机控制多个相同对象的场合</li>
<li>分区大小不等</li>
</ul></li>
<li><p>操作系统如何记录内存分类情况</p>
<ul>
<li>建立一个数据结构--<code>分区说明表</code></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">分区号</th>
<th style="text-align: center;">大小</th>
<th style="text-align: center;">起始地址</th>
<th style="text-align: center;">状态</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">未分配</td>
</tr>
</tbody>
</table></li>
<li><p>优点：</p>
<ul>
<li>易于实现，开销小，无外零头</li>
</ul></li>
<li><p>缺点：</p>
<ul>
<li>有内部碎片</li>
<li>分区总数固定，限制了并发执行的程序数目</li>
<li>存储空间利用率太低</li>
</ul></li>
</ul></li>
<li><p>动态分区分配(可变分区分配)</p>
<ul>
<li>概念：
<ul>
<li>在进程装入内存的时候根据进程的大小动态的建立分区</li>
</ul></li>
<li>采用什么样的数据结构记录
<ul>
<li>空闲分区表：参照分区说明表</li>
<li>空闲分区链</li>
</ul></li>
<li>数目固定，大小可变</li>
<li>数目和大小均可变</li>
</ul></li>
</ul>
</blockquote>
<p>动态分区分配算法</p>
<p>优点考虑的方面：</p>
<blockquote>
<p>基于顺序搜索的动态分区分配算法:</p>
<ul>
<li><p>最佳适应算法BF</p>
<ul>
<li><p>算法思想：空闲分区按照容量递增的顺序连接，找到大小能够满足的第一个空闲分区</p></li>
<li><p>优点：为大作业分配大的空间创造了条件</p></li>
<li><p>缺点：经过一段时间后，会产生很多很小的小分区(为了改善这种情况，就是设置一个最小分区参数G);还有一个缺点，就是回收分区的时候比较费时，因为需要进行排序。</p></li>
</ul></li>
<li><p>最坏适应算法WF</p>
<ul>
<li>算法思想：空闲分区按照容量递减的顺序连接，找到大小能够满足的第一个空闲分区</li>
<li>优点：使剩下的空闲分区不至于太小，产生碎片几率最小，对中、小作业有利，查找效率高</li>
<li>缺点：会缺乏比较大的空闲分区</li>
</ul></li>
<li><p>首次适应算法FF</p>
<ul>
<li><p>算法思想：空闲分区链以地址递增的次序链接，每次都从低地址开始查找，找到第一个能满足大小的空闲分区</p></li>
<li><p>优点：优先使用内存低地址，为大作业分配大的内存空间创造了条件</p></li>
<li><p>缺点：低地址被不断划分，会留下很多难以利用的、很小的的空闲分区。增加查找可用空闲分区开销。</p></li>
</ul></li>
<li><p>循环首次适应算法NF</p>
<ul>
<li><p>算法思想：是基于FF的改进算法，可以把空闲分区排成一个循环链表，每次分配时从上次查找结束的位置开始</p></li>
<li><p>优点：使空闲分区分布的更加均匀，从而减少了查找空闲分区时的开销</p></li>
<li><p>缺点：缺乏大的空闲分区</p></li>
</ul></li>
</ul>
<p>基于索引搜索的动态分区分配算法：</p>
<ul>
<li><p>快速适应算法QF</p>
<p>优点：查询效率高，不会对任何分区切割，满足对大空间的需求</p>
<p>缺点：算法复杂，系统开销大</p></li>
<li><p>伙伴系统</p>
<p>在伙伴系统中，可用内存块的大小为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.152ex" height="1.932ex" role="img" focusable="false" viewbox="0 -853.7 951.4 853.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container></span>,1≤k≤m</p>
<p>优点:</p>
<ul>
<li>分配和回收内存速度快，且不会产生很多小碎片</li>
</ul>
<p>缺点:</p>
<ul>
<li>内存利用率不高，分配的内存大小为2的幂，有内部碎片产生</li>
</ul></li>
<li><p>哈希算法</p>
<p>构建一张哈希表，以<code>空闲分区大小</code>为关键字</p></li>
</ul>
</blockquote>
<p>紧凑</p>
<blockquote>
<p>概念:</p>
<ul>
<li>将内存中的所有作业移动，使他们全部邻接，可把原来分散的很多小分区合并成大分区</li>
</ul>
<p>启动紧凑的时机:</p>
<ul>
<li>载入大程序，系统无可用分区</li>
<li>发现碎片比较多，系统比较空闲时</li>
</ul>
</blockquote>
<h4 id="非连续分配方式">4.2.2 非连续分配方式</h4>
<blockquote>
<ul>
<li>分页存储管理</li>
<li>分段存储管理</li>
<li>段页式存储管理</li>
</ul>
</blockquote>
<p>A 基本分页存储管理</p>
<p><img src="/2023/03/01/Courses/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20230519184618511.png" srcset="/img/loading.gif" lazyload alt="image-20230519184618511" style="zoom: 67%;"></p>
<blockquote>
<p>概念：</p>
<ul>
<li>将内存空间划分位一个个大小相等的分区，每个分区称为一个页框，每个页框有一个页框号(页框也称为内存块，物理页面，页帧)</li>
<li>将进程的逻辑地址空间也划分为与页框大小相等的一个一个部分，每个部分称为一个页或者说页面，每个页有一个页号，从0开始</li>
</ul>
<p>分页：</p>
<ul>
<li>将程序地址空间分页</li>
</ul>
<p>分块：</p>
<ul>
<li>将内存空间分块</li>
<li>内存一块可以装入程序一页</li>
</ul>
<p>优点：</p>
<ul>
<li>没有外零头</li>
<li>仅有小于一个页面大小的内零头</li>
</ul>
<p>页表：</p>
<ul>
<li><p>每个进程对应一个页表，描述该进程的各页面在内存中对应的物理编号，页表通常在PCB中，每个页表项由页号和块号组成，记录二者之间的映射关系</p></li>
<li><p>页号是可以不存的，因为程序地址是连续的</p></li>
<li><p>由计算机中内存块的数量--&gt;页表中页框号的位数是一个重要考点</p></li>
<li><p>计算：</p>
<ul>
<li>通用
<ul>
<li>页号=逻辑地址 / 页面大小</li>
<li>页内偏移量=逻辑地址 % 页面大小</li>
<li>物理地址 = 页面在内存中的起始地址 + 页内偏移量</li>
</ul></li>
<li>若每个页面大小是<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.152ex" height="1.932ex" role="img" focusable="false" viewbox="0 -853.7 951.4 853.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g></g></g></g></svg></mjx-container></span>B
<ul>
<li>则逻辑地址的可拆分为(页号，k位页内偏移量)</li>
<li>则物理地址的可拆分为(页框号，k位页内偏移量)</li>
</ul></li>
</ul></li>
<li><p>页表示意图：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">页号(隐式)</th>
<th style="text-align: center;">块号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">12</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">18</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: center;">124</td>
</tr>
</tbody>
</table></li>
</ul>
<p>:star:基本地址变换机构：</p>
<ul>
<li><p>作用：借助页表将逻辑地址转换位物理地址</p></li>
<li><p>实现：在系统中设置一个页表寄存器PTR，存放页表的起始地址F和页表长度M(有多少页)</p>
<p>进程未执行时，F和M存放于PCB，进程执行时，F和M被加载到PTR</p></li>
<li><p>步骤：</p>
<ul>
<li>根据逻辑地址计算页号和页内偏移量</li>
<li>判断页号是否越界(页号是否超过PTR中的页表长度)</li>
<li>查询页表，找到对应的页表项，确定内存块号</li>
<li>利用内存块号和页内偏移量得到物理地址</li>
<li>访问内存单元</li>
</ul></li>
<li><p>为了更方便查找页表项，页表一般是放在连续的内存块中的</p></li>
<li><p>实际应用中，通常使一个页框恰好放入整数个页表项</p></li>
</ul>
<p>页面大小的选择：</p>
<ul>
<li>影响页面与页框大小的因素：页内零头，地址转换速度，页面交换效率</li>
<li>页面大小常是2的幂，通常在1KB~8KB之间</li>
</ul>
<p>:star:具有快表的地址变换机构：</p>
<ul>
<li>定义：
<ul>
<li>快表，又称联想寄存器，TLB(translation lookaside
buffer)，是一种高速缓存，存放最近访问的页表项的副本，可以加速地址变换的速度，内存中的页表常称为慢表</li>
</ul></li>
<li>进程切换时，TLB会被清空</li>
<li>原理：局部性原理
<ul>
<li>时间局部性原理：如果执行了程序中的某条指令/数据，那么不久后这条指令有可能再次被执行/访问</li>
<li>空间局部性原理：一旦程序访问了某个存储单元，在不久后，其附近的存储单元也很有可能被访问</li>
</ul></li>
<li>若快表命中，只需访问一次内存，若未命中则需要访存两次</li>
<li>TLB和普通Cache的区别：TLB中只有页表项的副本，而普通Cache可能会有其它各种数据的副本</li>
</ul>
<p>:star:两级页表：</p>
<ul>
<li><p>单级页表存在的问题：</p>
<ul>
<li>对于32位的逻辑地址，若页面大小为4kB，因此页内地址占用12位，页号占用20位，因此一个进程最多有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewbox="0 -833.9 1290.1 833.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/></g></g></g></g></g></svg></mjx-container></span>个页表项；页表项为4B，一个页框存取<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewbox="0 -833.9 1290.1 833.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/></g></g></g></g></g></svg></mjx-container></span>个页表项，因此需要<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewbox="0 -833.9 1290.1 833.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"/></g></g></g></g></g></svg></mjx-container></span>个连续的页框，本身就违背了非连续存储的设计初衷</li>
<li>根据局部性原理，很多时候，进程只需要访问某几个页面就可以运行了，没必要让整个页表都常驻内存</li>
</ul></li>
<li><p>如何实现：</p>
<ul>
<li>将逻辑地址拆分为三部分：一级页号，二级页号，页内偏移量</li>
<li>从PCB中读出页目录表始址，再根据一级页号查页目录表，找到下一级页表在内存中的存放位置</li>
<li>没必要让整个页面都常驻内存，可以让页目录表新增一个字段“是否在内存中”，若想访问的页面不在内存中，就发生缺页中断，调入内存</li>
</ul>
<figure>
<img src="/2023/03/01/Courses/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20230508212207795.png" srcset="/img/loading.gif" lazyload alt="image-20230508212207795">
<figcaption aria-hidden="true">image-20230508212207795</figcaption>
</figure></li>
<li><p>注意：</p>
<ul>
<li>若采用多级页表，各级页表的大小不能超过一个页面</li>
<li>当没有快表机构时，N级页表访问一个逻辑地址需要N+1次访存</li>
</ul></li>
<li><p>页目录表示意图：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">一级页号</th>
<th style="text-align: center;">内存块号</th>
<th style="text-align: center;">是否在内存中</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">是</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">无</td>
<td style="text-align: center;">否</td>
</tr>
<tr class="odd">
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
</tr>
</tbody>
</table></li>
</ul>
</blockquote>
<p>B 基本分段存储管理</p>
<p><img src="/2023/03/01/Courses/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/image-20230519184719922.png" srcset="/img/loading.gif" lazyload alt="image-20230519184719922" style="zoom:67%;"></p>
<blockquote>
<p>定义：</p>
<ul>
<li>与分页最大的区别就是离散分配时所分配地址空间的基本单位不同</li>
<li>按照程序的自身逻辑关系划分为若干个段，每个段有一个段名</li>
</ul>
<p>分段：</p>
<ul>
<li>分段系统的逻辑地址可以分为两部分：<code>段号 段内地址</code></li>
<li>段号的位数决定每一个进程最多可以分为几个段</li>
<li>段内地址位数决定了每个段的最大长度是多少</li>
</ul>
<p>引入分段存储管理方式可以满足下列需要:</p>
<ul>
<li>方便编程</li>
<li>信息共享</li>
<li>信息保护</li>
<li>数据增长</li>
<li>动态链接</li>
</ul>
<p>段表：</p>
<ul>
<li>为每一个进程建立一张段映射表，记录各个逻辑段在物理内存中的位置：<code>(段号) 段长 基址</code></li>
<li>各个段表项的长度是相同的</li>
<li>当发生进程切换时，从PCB加载信息到段表寄存器(存放段表始址F和段表长度M)</li>
</ul>
<p>步骤：</p>
<ul>
<li>根据逻辑地址得到段号和段内地址</li>
<li>根据段表寄存器判断是否越界(若段号S≥段表长度M则越界)</li>
<li>查询段表，找到段表项</li>
<li>检查段内地址是否超过段长(这一步与分页存储管理方式不同)</li>
<li>计算得到物理地址</li>
</ul>
<p>分页与分段的比较：</p>
<ul>
<li>页是信息的物理单位，分页主要目的是实现离散分配，提高内存利用率，对用户是不可见的</li>
<li>段是信息的逻辑单位，分段的主要目的是更好的满足用户需求，分段对用户是可见的</li>
<li>分页的用户进程地址空间是一维的，分段的用户进程地址空间是二维的</li>
<li>分段比分页更容易实现信息的共享与保护</li>
<li>页表与段表：
<ul>
<li>页表：<code>(页号) 页基址</code></li>
<li>段表：<code>(段号) 段长 段基址</code></li>
</ul></li>
<li>页表寄存器与段表寄存器：
<ul>
<li>页表寄存器：<code>页表地址F 页表长度M</code></li>
<li>段表寄存器：<code>段表地址F 段表长度M</code></li>
</ul></li>
<li>逻辑地址划分：
<ul>
<li>分页：<code>页号 页偏移地址</code></li>
<li>分段：<code>段号 段偏移地址</code></li>
</ul></li>
</ul>
<p>分页和分段的不同:</p>
<ol type="1">
<li>页是物理单位，段是逻辑单位</li>
<li>页的大小固定且由系统决定，段的长度不固定</li>
<li>分页的作业地址空间是一维的，分段则是二维</li>
</ol>
</blockquote>
<p>C 段页式管理方式</p>
<blockquote>
<p>定义：</p>
<ul>
<li>分段+分页=段页式管理</li>
</ul>
<p>特点：</p>
<ul>
<li>分段对用户来说是可见的，程序员在编程时需要显式地给出段号，段内地址</li>
<li>分页对用户来说是不可见的，系统根据段内地址自动划分页号和页内偏移量</li>
<li>段页式管理的地址结构是二维的</li>
</ul>
<p>逻辑地址划分：</p>
<ul>
<li><code>段号 页号 页内偏移量</code></li>
<li>段号决定每个进程最多可以分为多少个段，页号决定每个段最大有多少页，页内偏移量决定了页面大小和内存块大小是多少</li>
</ul>
<p>段表和页表：</p>
<ul>
<li>每个段对应一个段表项，每个段表项由<code>(段号)</code>,<code>页表长度</code>，<code>页表起始地址</code>组成。首先根据页表起始地址找到页表，然后根据页表找到最终的数据</li>
<li>一个进程对应一个段表，但是一个进程可能对应多个页表</li>
</ul>
</blockquote>
<h3 id="内存扩充">4.3 内存扩充</h3>
<h4 id="覆盖技术">4.3.1 覆盖技术</h4>
<blockquote>
<ul>
<li>覆盖技术的思想
<ul>
<li>将程序分为多个段，内存中设置一个固定区和若干个覆盖区</li>
<li>需要常驻内存的段放在<code>固定区</code>中，不常用的段放在<code>覆盖区</code>，需要时调入内存，用不到时调出内存</li>
</ul></li>
<li>缺点
<ul>
<li>必须由程序员声明覆盖结构，操作系统完成自动覆盖，对用户不透明，增加了用户编程的负担</li>
</ul></li>
<li>其他
<ul>
<li>覆盖技术只用于早期的操作系统，现在已成为历史</li>
</ul></li>
</ul>
</blockquote>
<h4 id="对换技术">4.3.2 对换技术</h4>
<blockquote>
<p>对换技术的设计思想 *
内存空间紧张时，系统将内存中某些进程暂时换出外存(但是PCB还在内存)，把外存中某些已具备运行条件的进程换入内存</p>
<p>为了实现进程对换，系统必须实现的三方面的功能</p>
<ul>
<li>对换空间的管理</li>
<li>进程的换入</li>
<li>进程的换出</li>
</ul>
<p>保存在外存的哪里 *
在具有交换功能的操作系统，通常会把磁盘空间分为<code>文件区</code>和<code>对换区</code>
* 文件区:存放文件，追求存储空间的利用率，采用离散分配方式 *
对换区：只占磁盘空间的小部分，被换出的进程数据放在<code>对换区</code>。对换区追求<code>换入换出速度</code>，因此通常采用<code>连续分配方式</code>
* 对换区的I/O速度比文件区的更快</p>
<p>换出哪些进程 *
可优先换出阻塞进程，或低优先级的进程，也会考虑进程在内存的驻留时间</p>
<p>其他 * 覆盖和交换的区别 * 覆盖是在同一个程序或者进程中的 *
交换是在不同进程或作业之间的</p>
</blockquote>
<h4 id="虚拟内存">4.3.3 虚拟内存</h4>
<blockquote>
<p>常规存储器管理方式的特征：</p>
<ul>
<li>一次性：要求将一个作业全部装入内存后才能运行
<ul>
<li>大作业无法运行</li>
<li>限制作业并发执行的程度</li>
</ul></li>
<li>驻留性：作业装入内存后一直驻留内存直到作业完成</li>
</ul>
<p>虚拟内存的实现思想：</p>
<ul>
<li>基于局部性原理，在程序装入时，可以将程序中很快就会用到的部分装入内存，暂时用不到的放在外存</li>
<li>程序执行过程中，当所访问的信息不在内存时，由操作系统负责将所需信息从外存调入内存</li>
<li>若程序内存空间不够，由操作系统负责将内存中暂时用不到的信息换出到外存</li>
</ul>
<p>虚拟内存的三个主要特征：</p>
<ul>
<li>多次性：一个作业可以被分为多次调入内存</li>
<li>对换性：作业在运行过程中允许换入换出</li>
<li>虚拟性：能够从逻辑上扩充内存容量，使用户看到的内存容量远大于实际的容量</li>
</ul>
<p>如何实现虚拟内存技术：</p>
<ul>
<li>建立在非连续分配方式的基础上</li>
</ul>
</blockquote>
<p>请求分页存储管理方式</p>
<blockquote>
<p>与基本分页存储管理的主要区别：</p>
<ul>
<li>程序执行过程中，当要访问的信息不在内存时，由操作系统负责将所需信息从外存调入内存</li>
<li>若内存空间不够，由操作系统负责将内存中暂时用不到的信息换出到外存</li>
</ul>
<p>系统必须提供的硬件支持:</p>
<ul>
<li>请求分页的页表机制</li>
<li>缺页中断机构</li>
<li>地址变换机构</li>
</ul>
<p>缺页中断与一般中断的区别:</p>
<ul>
<li>在指令执行期间产生和处理中断信号</li>
<li>一条指令在执行期间，可能发生多次缺页中断</li>
</ul>
<p>请求分页存储管理的页表：</p>
<ul>
<li><code>(页号，页框号Q，状态位D，访问位A，修改位M，外存地址)</code></li>
<li>状态位：是否已经调入内存</li>
<li>访问位：可记录最近被访问过几次，或者上次访问的时间，供置换算法参考</li>
<li>修改位：页面调入内存后是否被修改过</li>
<li>外存地址：页面在外存中的存放位置</li>
</ul>
</blockquote>
<p>页面置换算法</p>
<blockquote>
<p>目标：尽可能的减少缺页率</p>
<p>最佳置换算法OPT:</p>
<ul>
<li>每次选择淘汰的页面将是以后永不使用，或在最长时间里不再访问的页面</li>
<li>最佳置换算法可以保证最低的缺页率，但是这个算法不可实现，因为页面访问的未来顺序是不知道的</li>
</ul>
<p>先进先出置换算法FIFO:</p>
<ul>
<li>每次选择淘汰的页面是最早进入内存的页面</li>
<li>Belady异常：当为进程分配的物理块号增大的时候，缺页次数不降反增的异常现象。在所有算法中，只有先入先出算法会产生Belady异常</li>
<li>特点：算法简单，但是性能差</li>
</ul>
<p>最近最久未使用置换算法LRU:</p>
<ul>
<li>每次淘汰的页面是最近最久未使用的页面</li>
<li>做题时可以逆向检此时在内存中的几个页面号</li>
<li>特点:算法的实现需要专门的硬件支持，虽然算法性能好，但是实现困难，开销大</li>
<li>性能最接近最佳置换算法</li>
</ul>
<p>Clock置换算法(最近未用算法NRU):</p>
<ul>
<li><p>简单的Clock算法:</p>
<ul>
<li>为每个页面设置一个访问位，再将内存中的页面通过链接指针链接成一个循环队列。</li>
<li>当某页被访问时，访问页面置为1</li>
<li>当需要淘汰一个页面时，只需检查页的<code>访问位</code>，若为0则置出；若是1则置为0，暂不换出，检查下一个页面</li>
<li>若第一轮扫描中所有页面都是1，则将所有页面置为0后再进行第二轮页面。因此简单的Clock算法最多会经过两轮扫描</li>
</ul></li>
<li><p>改进型的Clock算法:</p>
<ul>
<li><p>除了考虑一个页面最近有没有被访问过外，还应该考虑是否被修改过。在其他条件都相同时，优先淘汰没有修改过的页面</p></li>
<li><p>算法规则：</p>
<p>用(访问位，修改位)的形式表示各页面的状态</p>
<ol type="1">
<li>第一轮：扫描到第一个(0,0)的页面进行替换，<code>不修改任何标志位</code></li>
<li>第二轮：若第一轮扫描失败，则重新扫描。找到第一个(0,1)的页面，同时<code>将所有扫描过的页面访问位置为0</code></li>
<li>第三轮：若第二轮扫描失败，则重新扫描。找到第一个(0,0)的页面，<code>不修改任何标志位</code></li>
<li>第四轮：若第三轮扫描失败，则重新扫描。找到第一个(0,1)的页面用于替换</li>
</ol></li>
<li><p>改进型的Clock算法最多会进行四轮扫描</p></li>
<li><p>优先级理解：</p>
<ol type="1">
<li>第一优先级：最近未访问，也未修改的页面</li>
<li>第二优先级：最近未访问，但修改过的页面</li>
<li>第三优先级：最近访问过，但未修改的页面</li>
<li>第四优先级：最近访问过，也修改过的页面</li>
</ol></li>
</ul></li>
</ul>
<p>缺页率的影响因素:</p>
<ul>
<li>页面置换算法</li>
<li>页面大小</li>
<li>进程所分配的物理块的数目</li>
<li>程序的固有属性</li>
</ul>
</blockquote>
<p>页面分配策略</p>
<blockquote>
<p>驻留集：请求分页存储管理中给进程分配的物理块的集合，一般小于进程的总大小</p>
<ul>
<li>太小：缺页频繁</li>
<li>太大：多道程序并发度下降，资源利用率降低</li>
</ul>
<p>物理块的分配策略：</p>
<ul>
<li><p>固定分配：进程的物理块数目在运行期间保持不变</p></li>
<li><p>可变分配：与固定分配相反</p></li>
<li><p>局部置换：发生缺页时只能选择进程自己的物理块进行置换</p></li>
<li><p>全局置换：可以将操作系统保留的空闲物理块分配给缺页进程，或者将别的进程持有的物理块置换到外存，再分配给缺页进程</p></li>
<li><p>注意：全局置换和固定分配是互斥的</p></li>
<li><p>分配策略的组合：</p>
<ul>
<li><p>固定分配局部置换</p>
<p>实现这种策略的困难在于：很难确定应为进程分配多少物理块</p></li>
<li><p>可变分配全局置换</p>
<p>只要进程发生缺页，都将获得新的物理块；仅当空闲物理块用完时，系统才会选择一个未锁定的页面调出，被选择调出的页面可能是系统中任何一个进程的页，因此这个被选中的进程拥有的物理块就会减少，缺页率会增加</p></li>
<li><p>可变分配局部置换</p>
<p>刚开始会为每个进程分配一定数量的物理块，当进程缺页，只允许从自己的物理块中选择一个换出外存。若进程频繁的缺页，系统会为其多分配几个物理块，直至该进程缺页率达到适当的程度；反之，若缺页率非常低，也可适当减少分配给该进程的物理块</p></li>
</ul>
<p>总结：</p>
<ul>
<li>可变分配全局置换：只要缺页就会分配新的物理块</li>
<li>可变分配局部置换：根据缺页的频率动态的增加或者减少进程的物理块</li>
</ul></li>
</ul>
<p>何时调入页面:</p>
<ul>
<li><p>预调页策略：以预测为基础，将那些预计在不久之后便会访问的页面，预先调入内存；</p>
<p>这种策略主要用于进程的首次调入</p></li>
<li><p>请求调页策略：只有缺页时才会将所缺页面调入内存</p>
<p>I/O开销比较大</p></li>
</ul>
<p>从何处调入页面:</p>
<ul>
<li><p>系统拥有足够的对换区空间：</p>
<p>进程运行时将全部有关文件从文件区拷贝到对换区，这样可以提高调页的速度</p></li>
<li><p>系统缺少足够的对换区空间:</p>
<p>凡是不会修改的文件，都直接从文件区调入</p>
<p>换出未被修改的文件时，直接丢弃</p>
<p>对于那些可能被修改的部分，在将他们换出时，调到对换区，以后需要时从对换区调入</p></li>
<li><p>UNIX方式:</p>
<p>运行前所有数据放在文件区，从文件区直接调入；若被使用的页面需要换出，则写回对换区，下次从对换区调入</p></li>
</ul>
<p>抖动：</p>
<ul>
<li>刚刚换出的页面又要换入内存，刚刚换入的页面又要换出内存</li>
<li>原因：进程频繁访问的页面数目高于可用的物理块数</li>
</ul>
<p>工作集:</p>
<ul>
<li>在某段时间间隔里，进程实际访问页面的集合</li>
<li>工作集窗口:可以看做时间段</li>
<li>工作集大小可能小于窗口尺寸</li>
<li>一般来说，驻留集大小不能小于工作集大小，否则进程在运行中会频繁缺页</li>
</ul>
</blockquote>
<h2 id="五设备">五、设备</h2>
<h3 id="io系统简介">5.1 IO系统简介</h3>
<blockquote>
<p>设备管理的对象：主要是IO设备</p>
<p>设备管理的基本任务：</p>
<ul>
<li>完成用户提出的IO请求</li>
<li>提高设备的速率</li>
<li>改善设备的利用率</li>
</ul>
<p>设备管理的主要功能：</p>
<ul>
<li>缓冲区管理</li>
<li>设备分配</li>
<li>设备处理</li>
<li>虚拟设备</li>
<li>实现设备的独立性</li>
</ul>
<p>IO系统的基本功能：</p>
<ul>
<li>设备分配</li>
<li>设备映射</li>
<li>设备驱动</li>
<li>IO缓冲区管理</li>
</ul>
<p>通用设备管理分层模型：</p>
<ul>
<li><p>用户层软件</p></li>
<li><p>设备独立性软件</p>
<ul>
<li><p>功能：</p>
<ul>
<li>建立逻辑设备名到物理设备名的<code>映射</code>关系</li>
<li>提供设备<code>保护</code>功能</li>
<li>数据<code>缓冲</code>区管理</li>
<li>设备的<code>分配</code>与回收</li>
</ul>
<p>逻辑设备表LUT:</p>
<ul>
<li>第一种方式是整个系统只设立一张LUT，适用于单用户操作系统</li>
<li>第二种方式是为每个用户设立一张LUT</li>
</ul></li>
</ul></li>
<li><p>设备驱动程序</p></li>
<li><p>中断处理程序</p></li>
<li><p>硬件</p></li>
</ul>
</blockquote>
<h3 id="中断处理程序">5.2 中断处理程序</h3>
<blockquote>
<p>中断处理程序的处理过程分成以下几个步骤:</p>
<ol type="1">
<li>测定是否有未响应的中断信号</li>
<li>保护被中断进程的运行环境
<ul>
<li>通常由硬件自动把PSW和程序计数器中的值保留到中断保留区中</li>
<li>然后把被中断进程的CPU现场信息(所有的CPU寄存器)都压入中断栈中</li>
</ul></li>
<li>转入相应的设备处理程序
<ul>
<li>由处理机对各个中断源进行测试，确定引起本次中断的IO设备，并对其发送应答信号，使之消除中断请求信号</li>
<li>将相应的中断处理程序的入口地址装入到程序计数器中，使处理机转向中断处理程序</li>
</ul></li>
<li>执行中断处理
<ul>
<li>首先从设备控制器中读出设备状态，判断此次中断是正常完成中断还是异常结束中断</li>
<li>若是前者，中断程序便结束处理；若还有命令，可发向控制器发送新的命令，进行新一轮的数据传送</li>
<li>若是异常，则根据异常的原因做响应的处理</li>
</ul></li>
<li>恢复被中断进程的现场</li>
</ol>
</blockquote>
<h3 id="设备驱动程序">5.3 设备驱动程序</h3>
<h4 id="io控制方式">5.3.1 IO控制方式</h4>
<blockquote>
<p>程序直接控制方式:</p>
<ul>
<li>实际就是不断轮询IO控制器的状态寄存器</li>
<li>优点:
<ul>
<li>实现简单</li>
</ul></li>
<li>缺点:
<ul>
<li>CPU和IO设备只能串行操作，CPU需要一直轮询检查，长期处于忙等状态</li>
</ul></li>
</ul>
<p>中断方式:</p>
<ul>
<li>CPU会在每个指令周期的末尾检查中断</li>
<li>中断处理过程需要保存和恢复进程的执行环境，这个过程也需要一定的时间开销，如果中断频率太高，也会降低系统性能</li>
<li>每次中断只能读入一个字</li>
<li>优点:
<ul>
<li>CPU和IO设备可并行操作，CPU利用率明显提升</li>
</ul></li>
<li>缺点:
<ul>
<li>频繁的中断处理会消耗较多的CPU时间</li>
</ul></li>
</ul>
<p>DMA方式(直接存储器存取):</p>
<ul>
<li>数据的传送单位改为块，而不是字</li>
<li>注意:每次读写只能是连续的块，若不连续则需要多条中断指令</li>
<li>特点
<ol type="1">
<li>数据传输的基本单位是数据块</li>
<li>所传送的数据从设备直接到内存</li>
<li>仅在传输一个或多个数据块的开始或结束时，才需要CPU干预，整块数据的传送是在设备控制器的控制完成的</li>
</ol></li>
<li>DMA控制器的组成:
<ul>
<li>主机和DMA控制器的接口</li>
<li>DMA控制器和块设备的接口</li>
<li>IO控制逻辑</li>
</ul></li>
<li>优点:
<ul>
<li>数据传输以块为单位，CPU的介入频率进一步降低，数据传输效率进一步增加，CPU和IO设备的并行性得到提升</li>
</ul></li>
<li>缺点:
<ul>
<li>CPU每发出一条IO指令，只能读写一个或多个连续的数据块</li>
</ul></li>
<li>组成:
<ul>
<li>DR:数据寄存器</li>
<li>MAR:内存地址寄存器</li>
<li>DC:数据计数器，表示剩余要读写的字节数</li>
<li>CR:命令/状态寄存器，存放CPU发来的IO命令或设备的状态信息</li>
</ul></li>
</ul>
<p>通道控制方式:</p>
<ul>
<li>是一种硬件，可以理解为一个简化的CPU，可以识别并执行一系列通道指令</li>
<li>优点:
<ul>
<li>CPU,通道,IO设备可并行操作，资源利用率很高</li>
</ul></li>
<li>缺点:
<ul>
<li>实现复杂，需要专门的通道硬件支持</li>
</ul></li>
</ul>
</blockquote>
<h3 id="磁盘">5.4 磁盘</h3>
<h4 id="磁盘的结构">5.4.1 磁盘的结构</h4>
<blockquote>
<p>磁道:</p>
<ul>
<li>无数同心圆</li>
</ul>
<p>扇区:</p>
<ul>
<li>一个磁道被划分为一个个扇区，每个扇区就是一个<code>磁盘块</code>，各个扇区存放的数据量相同，因此最内侧磁道上的面积最小，数据密度也最大</li>
</ul>
<p>可用(<code>柱面号</code>，<code>盘面号</code>，<code>扇区号</code>)来定位任意一个磁盘块</p>
</blockquote>
<h4 id="磁盘调度算法">5.4.2 磁盘调度算法</h4>
<p>一次磁盘读写操作需要的时间</p>
<blockquote>
<p>寻道时间<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.541ex" height="1.906ex" role="img" focusable="false" viewbox="0 -677 1123.1 842.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"/></g></g></g></g></svg></mjx-container></span>：s+m*n</p>
<ul>
<li>启动磁头臂时间s</li>
<li>移动磁头的时间:设跨越1个磁道耗时m，总共需要跨越n条磁道</li>
</ul>
<p>延迟时间<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.373ex;" xmlns="http://www.w3.org/2000/svg" width="2.723ex" height="1.905ex" role="img" focusable="false" viewbox="0 -677 1203.7 841.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g></g></g></svg></mjx-container></span>：</p>
<ul>
<li>通过旋转磁盘，使磁头定位到目标扇区所需要的时间，设磁盘转速为r，则平均所需的延迟时间为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="18.074ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 7988.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g><g data-mml-node="mo" transform="translate(1481.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mo" transform="translate(2537.2,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(2926.2,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3426.2,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"/></g></g><g data-mml-node="mn" transform="translate(3926.2,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mo" transform="translate(4426.2,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(5037.5,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"/></g><g data-mml-node="mo" transform="translate(5759.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(6148.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6648.7,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"/></g></g><g data-mml-node="mi" transform="translate(7148.7,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(7599.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></span></li>
</ul>
<p>传输时间<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.087ex" height="1.889ex" role="img" focusable="false" viewbox="0 -677 922.3 834.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g></g></g></g></svg></mjx-container></span>:</p>
<ul>
<li>假设磁盘转速为r,读写字节数为b，每个磁道上的字节数为N</li>
<li><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="28.063ex" height="2.262ex" role="img" focusable="false" viewbox="0 -750 12403.8 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g></g><g data-mml-node="mo" transform="translate(1200,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mo" transform="translate(2255.8,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mn" transform="translate(2644.8,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3144.8,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"/></g></g><g data-mml-node="mi" transform="translate(3644.8,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(4095.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(4707,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"/></g><g data-mml-node="mo" transform="translate(5429.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(5818.3,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6247.3,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"/></g></g><g data-mml-node="mi" transform="translate(6747.3,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(7635.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g><g data-mml-node="mo" transform="translate(8302,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(9357.8,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(9786.8,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"/></g></g><g data-mml-node="mo" transform="translate(10286.8,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/></g><g data-mml-node="mi" transform="translate(10675.8,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(11126.8,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mo" transform="translate(12014.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/></g></g></g></svg></mjx-container></span></li>
</ul>
<p>平均存取时间<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="18.255ex" height="1.906ex" role="img" focusable="false" viewbox="0 -677 8068.5 842.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/></g></g><g data-mml-node="mo" transform="translate(1318.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2374.6,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"/></g></g><g data-mml-node="mo" transform="translate(3719.9,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(4720.1,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g><g data-mml-node="mo" transform="translate(6146.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(7146.3,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g></g></g></g></svg></mjx-container></span></p>
</blockquote>
<p>优化寻道时间的算法</p>
<blockquote>
<p>先来先服务算法FCFS:</p>
<ul>
<li>优点:
<ul>
<li>公平，如果请求访问的磁道比较集中的话，算法性能还说得过去</li>
</ul></li>
<li>缺点:
<ul>
<li>如果有大量进程竞争使用磁盘，请求访问的磁道很分散，则FCFS性能很差</li>
</ul></li>
</ul>
<p>最短寻找时间优先SSTF:</p>
<ul>
<li>类似贪心算法，但是总体不一定最优</li>
<li>优点:
<ul>
<li>性能较好，平均寻道时间短</li>
</ul></li>
<li>缺点:
<ul>
<li>可能产生饥饿现象</li>
</ul></li>
</ul>
<p>扫描算法SCAN:</p>
<ul>
<li>只有磁头移动到最外侧磁道的时候才能向内移动，只有移动到最内侧磁道的时候才能往外移动</li>
<li>优点:
<ul>
<li>性能较好，平均寻道时间短，不会产生饥饿现象</li>
</ul></li>
<li>缺点:
<ul>
<li>只有到达最边上的磁道时才能改变磁头移动方向(解决:LOOK算法)</li>
<li>对于各个位置的磁道的响应频率不平均(解决:C-SCAN算法)</li>
</ul></li>
</ul>
<p>循环扫描算法C-SCAN:</p>
<ul>
<li>优点:
<ul>
<li>各个位置磁道的响应频率很平均</li>
</ul></li>
<li>缺点:
<ul>
<li>只有到达最边上的磁道时才能改变磁头移动方向</li>
</ul></li>
</ul>
</blockquote>
<h4 id="磁盘管理">5.4.3 磁盘管理</h4>
<blockquote>
<p>磁盘初始化:</p>
<ol type="1">
<li>低级格式化(物理格式化),将磁盘的各个磁道划分为扇区。一个扇区通常分为头，数据区域，尾三个部分，管理扇区所需要的各种数据结构一般存放在头和尾，比如扇区校验码</li>
<li>将磁盘分区，每个分区由若干个相邻的柱面组成</li>
<li>逻辑格式化:创建文件系统。比如文件系统的根目录，初始化存储空间管理所用的数据结构</li>
</ol>
<p>引导块:</p>
<ul>
<li>计算机开机时需要进行一系列的初始化工作，这些初始化工作时通过执行初始化程序完成的</li>
<li>ROM中只存放很小的自举装入程序，完整的自举程序放在磁盘的启动块上，位于磁盘的固定位置。拥有启动分区的磁盘称为启动磁盘</li>
</ul>
<p>坏块的管理:</p>
<ul>
<li>在逻辑初始化时，对整个磁盘进行坏块检查，表明哪些扇区是坏扇区，比如在FAT表中标明，坏块对操作系统不透明</li>
<li>对于复杂的磁盘，磁盘控制器(硬件)会维护一个坏块链表</li>
<li>在磁盘出厂前进行敌机格式化，将坏块链初始化。另外，磁盘控制器还会保留一些备用扇区，用于替换坏块，这种方案称为<code>扇区备用</code>，这种情况下坏块对操作系统透明</li>
</ul>
</blockquote>
<h3 id="不考">不考</h3>
<p>假脱机技术SPOOLing技术</p>
<blockquote>
<p>独占式设备:</p>
<ul>
<li>只允许各个进程串行使用的设备</li>
</ul>
<p>共享设备:</p>
<ul>
<li>允许多个进程同时使用的设备(微观上可能是交替的)</li>
</ul>
<p>假脱机技术(SPOOLing技术):</p>
<ul>
<li>用软件的方法模拟脱机技术，系统会建立输入进程和输出进程</li>
</ul>
</blockquote>
<p>IO设备的概念和分类</p>
<blockquote>
<p>按照设备上的数据组织形式:</p>
<ul>
<li>块设备</li>
<li>字符设备</li>
</ul>
<p>按照资源分配的角度分类:</p>
<ul>
<li>独占设备</li>
<li>共享设备</li>
<li>虚拟设备</li>
</ul>
</blockquote>
<p>IO控制器</p>
<blockquote>
<p>概念:</p>
<ul>
<li>CPU无法直接控制IO设备的机械部件，因此IO设备还有一个电子部件作为CPU和IO机械部件之间的中介，用于实现CPU对设备的控制</li>
</ul>
<p>IO控制器的功能:</p>
<ul>
<li>接受和识别CPU发出的命令--&gt;控制寄存器</li>
<li>向CPU报告设备的状态--&gt;状态寄存器</li>
<li>数据交换--&gt;数据寄存器</li>
<li>地址识别</li>
</ul>
<p>IO控制器的组成:</p>
<ul>
<li>CPU与控制器之间的接口</li>
<li>IO逻辑</li>
<li>控制器和设备之间的接口</li>
</ul>
<p>两种寄存器编制方式:</p>
<ul>
<li>内存映射IO</li>
<li>寄存器独立编制</li>
</ul>
</blockquote>
<p>设备的分配和回收</p>
<blockquote>
<p>设备分配时应该考虑的因素:</p>
<ul>
<li>设备的固有属性
<ul>
<li>独占设备</li>
<li>共享设备</li>
<li>虚拟设备</li>
</ul></li>
<li>设备分配算法</li>
<li>设备分配的安全性
<ul>
<li>安全分配方式：一个时段内每个进程只能使用一个设备
<ul>
<li>优点：破坏了请求和保持条件，不会死锁</li>
<li>缺点：对于一个进程来说，CPU和IO设备只能串行操作</li>
</ul></li>
<li>不安全分配方式：进程发出IO请求后，系统为其分配IO设备，进程可继续执行，之后还会发出新的IO请求
<ul>
<li>优点：进程的计算任务和IO任务可以并行处理，使进程迅速推进</li>
<li>缺点：有可能发生死锁</li>
</ul></li>
</ul></li>
</ul>
<p>设备控制表DCT:</p>
<ul>
<li>用于记录设备情况</li>
</ul>
<p>控制器控制表COCT:</p>
<ul>
<li>每个设备控制器对应一张COCT</li>
</ul>
<p>通道控制表CHCT:</p>
<ul>
<li>每个通道对应一张CHCT</li>
</ul>
<p>系统设备表SDT:</p>
<ul>
<li>记录了系统中全部设备的情况，每个设备对应一个表目</li>
</ul>
</blockquote>
<p>缓冲区管理</p>
<blockquote>
<p>缓冲区的作用:</p>
<ol type="1">
<li>缓和CPU和IO设备速度不匹配的矛盾</li>
<li>减少中断频率</li>
<li>解决数据粒度不匹配的问题</li>
<li>提高CPU与IO设备的并行性</li>
</ol>
<p>单缓冲:</p>
<ul>
<li>在主存中为其分配一个缓冲区</li>
</ul>
<p>双缓冲:</p>
<p>循环缓冲</p>
<p>缓冲池</p>
</blockquote>
<h2 id="六文件管理">六、文件管理</h2>
<h3 id="文件和文件系统的概念">6.1 文件和文件系统的概念</h3>
<blockquote>
<p>文件的定义：</p>
<ul>
<li>由创建者所定义的，具有文件名的一组相关元素的集合</li>
</ul>
<p>文件系统的定义：</p>
<ul>
<li>操作系统中的各类文件，管理文件的软件，以及管理文件涉及到的数据结构的信息的集合</li>
</ul>
<p>文件系统的功能：</p>
<ol type="1">
<li>有效的管理文件的存储空间</li>
<li>管理文件目录</li>
<li>完成文件的读写操作</li>
<li>完成文件的共享和保护</li>
<li>为用户提供交互式命令接口和程序调用接口</li>
</ol>
</blockquote>
<h3 id="文件的结构">6.2 文件的结构</h3>
<h4 id="逻辑结构">6.2.1 逻辑结构</h4>
<p>就是从用户观点出发观察到的文件组织形式</p>
<blockquote>
<p>按照有无结构分类:</p>
<ul>
<li><p>无结构文件:</p>
<p>文件内部的数据就是一系列二进制或字符流组成，又称“流式文件”，比如<code>.txt</code></p></li>
<li><p>有结构文件:</p>
<p>由一组相似的记录组成，又称“记录式文件”。每组记录又由若干记录项组成，比如数据库</p>
<ul>
<li><p>顺序文件</p>
<ul>
<li>链式存储
<ul>
<li>无论定长/可变长记录，都无法实现随机选取</li>
</ul></li>
<li>顺序存储
<ul>
<li>可变长记录：无法实现随机存取</li>
<li>定长记录
<ul>
<li>可实现随机存取</li>
<li>若采用串结构(记录之间的顺序与关键字无关)：无法快速找到某关键词对应的记录</li>
<li>若采用顺序结构(记录之间的顺序按照关键字顺序排列)：可以快速找到某关键字对应的记录</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>索引文件</p></li>
<li><p>索引顺序文件:并不是每个记录对应一个索引表项，而是一组记录对应一个索引表项</p></li>
</ul></li>
</ul>
</blockquote>
<h4 id="物理结构">6.2.2 物理结构</h4>
<blockquote>
<p>解决的问题:</p>
<ul>
<li>文件数据应该怎样存放在外存中</li>
</ul>
<p>文件块和磁盘块:</p>
<ul>
<li>类似进程分页，文件的逻辑地址空间也被分为了一个一个的文件块，于是文件的逻辑地址也可表示为(<code>逻辑块号</code>,<code>块内地址</code>)的形式</li>
</ul>
<p>连续分配:</p>
<ul>
<li>思想:要求每个文件在磁盘上占有一组连续的块</li>
<li>如何实现:FCB中必须包含<code>起始块号</code>和<code>长度</code></li>
<li>优点:
<ul>
<li>顺序访问容易，可快速检索文件的第一个数据块</li>
<li>顺序访问速度快，磁头移动距离短，效率最高</li>
</ul></li>
<li>缺点:
<ul>
<li>要求有连续的存储空间，会有磁盘碎片产生</li>
<li>必须事先知道文件长度，不利于文件大小的变化</li>
</ul></li>
</ul>
<p>链接分配:</p>
<ul>
<li><p>思想:采取离散分配的方式，可以为文件分配离散的磁盘块，分为隐式链接和显式链接两种</p>
<ul>
<li><p>隐式链接</p>
<p>FCB中需要指明<code>起始块号</code>和<code>结束块号</code>，每个磁盘块都会保存指向下一个盘块的指针，指针对于用户来说是透明的</p>
<p>优点：很方便对文件进行拓展，不会有碎片问题，外存利用率高</p>
<p>缺点：查找效率低，只支持顺序访问，不支持随机访问，指向下一个盘块的指针也需要耗费少量的存储空间</p></li>
<li><p>显式链接</p>
<p>把用于链接文件各物理块的指针显式地存放在一张表中，也就是文件分配表FAT：(<code>物理块号</code>，<code>下一块</code>)</p>
<p>一个磁盘仅设置一张FAT，开机时将FAT读入内存，并常驻内存</p>
<p>优点：很方便对文件进行拓展，不会有碎片问题，外存利用率高，<code>并且支持随机访问</code>，相比于隐式链接来说，地址转换不需要访问磁盘，<code>文件的访问效率更高</code></p>
<p>缺点：文件分配表FAT需要占用一定的存储空间</p></li>
</ul></li>
</ul>
<p>索引分配:</p>
<ul>
<li>思想：参考页表，为每个文件建立一张索引表，索引表中记录了文件的各个逻辑块对应的物理块</li>
<li>索引表存放的磁盘块称为<code>索引块</code>，文件数据存放的磁盘块称为<code>数据块</code></li>
<li>需要在FCB中记录索引块</li>
<li>优点：支持随机访问，文件拓展也很容易实现</li>
<li>缺点：索引表可能会占据一定的存储空间</li>
<li>如何解决索引表过大的问题?
<ul>
<li>链接方案：将多个索引块链接起来存放</li>
<li>多层索引：类似于多级页表，若采用K层索引结构，且顶级索引表未调入内存，则访问一个数据块需要K+1次读磁盘操作
<ul>
<li>改进：混合索引：引入一个顶级索引表，前面几项是直接地址索引，后面是一级间接索引和二级间接
索引</li>
</ul></li>
</ul></li>
</ul>
</blockquote>
<h3 id="文件存储空间管理">6.3 文件存储空间管理</h3>
<blockquote>
<p>存储空间的划分和初始化:</p>
<ul>
<li>存储空间的划分:将物理磁盘划分为一个一个的文件卷</li>
<li>存储空间的初始化:将每个文件卷划分为目录区和文件区</li>
<li>在部分操作系统中，支持将多个物理磁盘组成一个文件卷</li>
</ul>
</blockquote>
<p>存储空间管理</p>
<blockquote>
<p>空闲表法:</p>
<ul>
<li><p>(<code>第一个空闲盘块号</code>，<code>空闲盘块数</code>)</p></li>
<li><p>如何分配磁盘块:</p>
<p>与内存管理中的动态分区分配很类似，为一个文件分配连续的存储空间，同样可采用BF，WF，FF，NF算法决定要为文件分配哪一个区间</p></li>
</ul>
<p>空闲链表法:</p>
<ul>
<li>空闲盘块链：以盘块为单位组成一条空闲链
<ul>
<li>如何分配：从链头开始依次选取若干个盘块进行分配，并修改空闲链的链头指针</li>
<li>如何回收：回收的盘块依次挂到链尾，并修改空闲链的链尾指针</li>
</ul></li>
<li>空闲盘区链：以盘区为单位组成一条空闲链(连续的空闲盘块组成一个空闲盘区，空闲盘区的第一个盘块记录盘区的长度和下一个盘区的指针)
<ul>
<li>如何分配：可采用BF，FF等算法</li>
<li>如何回收：若回收区和某个空闲盘区相邻，则需要将回收区合并到空闲盘区中；若回收区没有和任何空闲区相邻，则将回收区作为一个单独的空闲盘区挂到链尾</li>
</ul></li>
</ul>
<p>位示图法:</p>
<ul>
<li>每个二进制位对应一个盘块，比如0代表空闲，1代表已分配</li>
<li>位示图一般用连续的<code>字</code>来表示，比如一个字的字长是16位，可以用(<code>字号</code>，<code>列号</code>)对应一个盘块号，也有的题目表示为(<code>行号</code>，<code>列号</code>)</li>
<li>如何分配：若文件需要k个块，顺序扫描位示图，找到k个相邻或不相邻的’0‘，算出其盘块号，分配文件，将相应位置为‘1’</li>
<li>如何回收：计算相应的字号和位号，将其置为’0‘</li>
</ul>
<p>成组链接法(Unix的方法):</p>
<ul>
<li>适合大型文件系统</li>
</ul>
</blockquote>
<h3 id="文件目录">6.4 文件目录</h3>
<blockquote>
<p>文件控制块FCB:</p>
<ul>
<li>FCB中包含了文件的基本信息，存储控制信息，使用信息</li>
<li>FCB的有序集合称为<code>文件目录</code></li>
</ul>
<p>目录结构:</p>
<ul>
<li><p>单级目录结构:</p>
<p>早期操作系统并不支持多级目录，整个系统中只建立一张目录表</p>
<p>实现了按名存取，但是<code>不允许文件重名</code>，不适用于多用户操作系统</p></li>
<li><p>两级目录结构:</p>
<ul>
<li>主文件目录MFD：记录用户名以及用户文件目录的存放位置</li>
<li>用户文件目录UFD：由该用户的文件FCB组成，<code>不能对文件进行分类</code></li>
</ul></li>
<li><p>层次目录结构:</p>
<p>不同目录下的文件是可以重名的</p>
<ul>
<li>树型目录：不便于实现文件的共享</li>
<li>无循环图目录：设置了共享计数器</li>
</ul></li>
</ul>
<p>索引节点(FCB的改进):</p>
<ul>
<li>(<code>文件名</code>，<code>索引节点指针</code>)，目录项的长度大幅减少</li>
<li>由于目录项长度减少，每个磁盘块可以存放更多的目录项，因此检索文件时磁盘I/O的次数就减少了很多</li>
</ul>
</blockquote>
<h3 id="文件共享和保护">6.5 文件共享和保护</h3>
<h4 id="共享">6.5.1 共享</h4>
<blockquote>
<p>基于索引节点的共享方式(硬链接):</p>
<ul>
<li>索引节点中设置一个链接计数变量count，用于表示链接到本索引节点上的用户目录项数</li>
<li>不同用户对同一个文件的命名可以不同</li>
<li>当链接计数变量count大于等于1时，删除文件只是让索引节点指针置空</li>
</ul>
<p>基于符号链的共享方式(软链接):</p>
<ul>
<li>类似于Windows中的快捷方式</li>
<li>即使软链接指向的共享文件已被删除，Link型文件依然存在，只不过通过其去查找共享文件会失败</li>
</ul>
</blockquote>
<h4 id="文件保护">6.5.2 文件保护</h4>
<blockquote>
<ol type="1">
<li><p>口令保护:</p>
<ul>
<li><p>口令一般存在文件对应的FCB或者索引节点中，操作系统会讲用户提供的口令与FCB中存储的口令进行对比，若正确才允许用户访问文件</p></li>
<li><p>优点:</p>
<ul>
<li>保存口令的空间开销和验证口令的时间开销小</li>
</ul></li>
<li><p>缺点:</p>
<ul>
<li>正确的口令存放在系统内部，不够安全</li>
</ul></li>
</ul></li>
<li><p>加密保护</p></li>
<li><p>访问控制:</p>
<ul>
<li>在每个文件的FCB或索引节点中增加一个访问控制列表ACL，记录各个用户可以对文件执行哪些操作</li>
</ul></li>
</ol>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Courses/" class="category-chain-item">Courses</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="print-no-link">#操作系统</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>操作系统</div>
      <div>https://d4wnnn.github.io/2023/03/01/Courses/操作系统/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>D4wn</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月1日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/02/Courses/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">计算机网络</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/02/28/Courses/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/" title="数据库原理及应用">
                        <span class="hidden-mobile">数据库原理及应用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"iQzcdzgtk7S3lKyzUoT3segU-gzGzoHsz","appKey":"mL1QjUEvvzJ9E2xIVz0OuJuj","path":"window.location.pathname","placeholder":"Hello","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://iqzcdzgt.lc-cn-n1-shared.com","emojiCDN":"https://valinecdn.bili33.top/","emojiMaps":{"QQ1":"QQ/aini.gif","QQ2":"QQ/aixin.gif","QQ3":"QQ/aoman.gif","QQ4":"QQ/baiyan.gif","QQ5":"QQ/bangbangtang.gif","QQ6":"QQ/baojin.gif","QQ7":"QQ/baoquan.gif","QQ8":"QQ/bishi.gif","QQ9":"QQ/bizui.gif","QQ11":"QQ/cahan.gif","QQ12":"QQ/caidao.gif","QQ13":"QQ/chi.gif","QQ14":"QQ/ciya.gif","QQ15":"QQ/dabing.gif","QQ16":"QQ/daku.gif","QQ17":"QQ/dan.gif","QQ18":"QQ/deyi.gif","QQ19":"QQ/doge.gif","QQ20":"QQ/fadai.gif","QQ21":"QQ/fanu.gif","QQ22":"QQ/fendou.gif","QQ23":"QQ/ganga.gif","QQ24":"QQ/gouyin.gif","QQ25":"QQ/guzhang.gif","QQ26":"QQ/haixiu.gif","QQ27":"QQ/hanxiao.gif","QQ28":"QQ/haobang.gif","QQ29":"QQ/haqian.gif","QQ30":"QQ/hecai.gif","QQ31":"QQ/hexie.gif","QQ32":"QQ/huaixiao.gif","QQ33":"QQ/jie.gif","QQ34":"QQ/jingkong.gif","QQ35":"QQ/jingxi.gif","QQ36":"QQ/jingya.gif","QQ37":"QQ/juhua.gif","QQ38":"QQ/keai.gif","QQ39":"QQ/kelian.gif","QQ40":"QQ/koubi.gif","QQ41":"QQ/ku.gif","QQ42":"QQ/kuaikule.gif","QQ43":"QQ/kulou.gif","QQ44":"QQ/kun.gif","QQ45":"QQ/lanqiu.gif","QQ46":"QQ/leiben.gif","QQ47":"QQ/lenghan.gif","QQ48":"QQ/liuhan.gif","QQ49":"QQ/liulei.gif","QQ50":"QQ/nanguo.gif","QQ51":"QQ/OK.gif","QQ52":"QQ/penxue.gif","QQ53":"QQ/piezui.gif","QQ54":"QQ/pijiu.gif","QQ55":"QQ/qiang.gif","QQ56":"QQ/qiaoda.gif","QQ57":"QQ/qinqin.gif","QQ58":"QQ/qiudale.gif","QQ59":"QQ/quantou.gif","QQ60":"QQ/saorao.gif","QQ61":"QQ/se.gif","QQ62":"QQ/shengli.gif","QQ63":"QQ/shouqiang.gif","QQ64":"QQ/shuai.gif","QQ65":"QQ/shui.gif","QQ66":"QQ/tiaopi.gif","QQ67":"QQ/touxiao.gif","QQ68":"QQ/tu.gif","QQ69":"QQ/tuosai.gif","QQ70":"QQ/weiqu.gif","QQ71":"QQ/weixiao.gif","QQ72":"QQ/woshou.gif","QQ73":"QQ/wozuimei.gif","QQ74":"QQ/wunai.gif","QQ75":"QQ/xia.gif","QQ76":"QQ/xiaojiujie.gif","QQ77":"QQ/xiaoku.gif","QQ78":"QQ/xiaoyanger.gif","QQ79":"QQ/xieyanxiao.gif","QQ80":"QQ/xigua.gif","QQ81":"QQ/xu.gif","QQ82":"QQ/yangtuo.gif","QQ83":"QQ/yinxian.gif","QQ84":"QQ/yiwen.gif","QQ85":"QQ/youhengheng.gif","QQ86":"QQ/youling.gif","QQ87":"QQ/yun.gif","QQ88":"QQ/zaijian.gif","QQ89":"QQ/zhayanjian.gif","QQ90":"QQ/zhemo.gif","QQ91":"QQ/zhouma.gif","QQ92":"QQ/zhuakuang.gif","QQ93":"QQ/zuohengheng.gif"},"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/d4wnnn" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="tencent://message/?uin=2638177031" target="_blank" rel="nofollow noopener"><span>联系我</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
